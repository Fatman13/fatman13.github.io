<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Fatman13]]></title>
  <link href="http://Fatman13.github.io/atom.xml" rel="self"/>
  <link href="http://Fatman13.github.io/"/>
  <updated>2014-03-28T23:07:52+08:00</updated>
  <id>http://Fatman13.github.io/</id>
  <author>
    <name><![CDATA[Fatman13]]></name>
    <email><![CDATA[tctctcly@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Cucumber小黄瓜页面级自动化测试入门教程]]></title>
    <link href="http://Fatman13.github.io/blog/2014/03/12/cucumberxiao-huang-gua-ye-mian-ji-zi-dong-hua-ce-shi-ru-men-jiao-cheng/"/>
    <updated>2014-03-12T20:44:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2014/03/12/cucumberxiao-huang-gua-ye-mian-ji-zi-dong-hua-ce-shi-ru-men-jiao-cheng</id>
    <content type="html"><![CDATA[<p>之前也写了<a href="http://tauntaunslayer13.me/blog/2014/01/26/ru-he-shi-yong-capybarahe-cucumbershi-xian-ye-mian-ji-bie-zi-dong-hua/">一篇</a>小黄瓜页面级自动化测试的教程，但是感觉写的可能不是最好。再尝试写一篇入门级别的页面自动化教程。源代码在<a href="https://github.com/Fatman13/cuke_midpage">这里</a>。</p>

<!--more-->


<h1>自动化测试对象</h1>

<p>这段<a href="https://github.com/Fatman13/cuke_midpage">源代码</a>主要自动化测试了<code>百度微购</code>页面上的几个链接是否为死链。</p>

<h1>使用代码</h1>

<ul>
<li>首先<code>git clone https://github.com/Fatman13/cuke_midpage.git</code>。</li>
<li><code>cd cuke_midpage</code>进入刚下载的文件夹中。</li>
<li>运行<code>bundle install</code>。</li>
<li>跑自动化case运行<code>cucumber</code>。（你应该能看到小黄瓜打开火狐，并验证给予的链接是否是死链）</li>
</ul>


<h1>源代码结构</h1>

<p>小黄瓜大致文件结构如下。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>D:.
</span><span class='line'>└─features
</span><span class='line'>    ├─step_definitions
</span><span class='line'>    └─support</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>features</code>文件夹：主要存放<code>.feature</code>文档。是每个测试case的文字解释。</li>
<li><code>step_definition</code>文件夹：主要存放<code>.rb</code>文件。每个case具体执行的代码，都应该放在这里。</li>
<li><code>support</code>文件夹：主要存放<code>env.rb</code>。主要定义一个环境变量。所有<code>require</code>都可以放在这儿里。因为<code>小黄瓜</code>在运行测试前，一定会先运行<code>env.rb</code>这个文件。</li>
</ul>


<p>如上所示，开发者只需将对应的<code>.feature</code>，<code>.rb</code>文件等等，按照小黄瓜约定，放入对应的文件夹中。运行<code>cucumber</code>时，小黄瓜就会自动在对应的文件夹中找运行case所需的代码。</p>

<h1>feature文档讲解</h1>

<p>作为一个<a href="http://en.wikipedia.org/wiki/Behavior-driven_development">BDD</a>行为驱动测试框架，小黄瓜会逼迫你写一些文档。给测死链case写一个feature文档可能略显<code>鸡肋</code>。这里主要是作为一个简单的例子做讲解一下<code>features/wgmp_link.feature</code>。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='cucumber'><span class='line'><span class="k">Feature:</span><span class="nf"> 中间页死链</span>
</span><span class='line'><span class="nf">  为了保证中间页没有死链。</span>
</span><span class='line'>
</span><span class='line'><span class="nf">  </span><span class="k">Scenario Outline:</span><span class="nf"> 测死链（Capybara）</span>
</span><span class='line'><span class="k">    When </span><span class="nf">我访问&quot;</span><span class="s">http://weigou.baidu.com</span><span class="nf">&quot;并点击</span><span class="nv">&lt;some_link&gt;</span><span class="nf">链接时</span>
</span><span class='line'><span class="nf">    </span><span class="k">Then </span><span class="nf">页面状态应该为&quot;</span><span class="s">200</span><span class="nf">&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nf">  </span><span class="k">Examples:</span><span class="nf"> 点这些</span><span class="k"></span>
</span><span class='line'><span class="k">      |</span><span class="nv"> some_link</span><span class="k"> |</span><span class="nf"></span>
</span><span class='line'><span class="k">      |</span><span class="s"> 团购</span><span class="k"> |</span>
</span><span class='line'>
</span><span class='line'><span class="nf">  </span><span class="nt">@new</span><span class="nf">   </span>
</span><span class='line'><span class="nf">  </span><span class="k">Scenario Outline:</span><span class="nf"> 测死链（http client）</span>
</span><span class='line'><span class="k">    When </span><span class="nf">我访问</span><span class="nv">&lt;some_link&gt;</span><span class="nf">链接时</span>
</span><span class='line'><span class="nf">    </span><span class="k">Then </span><span class="nf">我得到的页面状态应该为&quot;</span><span class="s">200</span><span class="nf">&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nf">  </span><span class="k">Examples:</span><span class="nf"> 点这些</span><span class="k"></span>
</span><span class='line'><span class="k">      |</span><span class="nv"> some_link</span><span class="k"> |</span><span class="nf"></span>
</span><span class='line'><span class="k">      |</span><span class="s"> http://weigou.baidu.com/</span><span class="k"> |</span><span class="nf"></span>
</span><span class='line'><span class="k">      |</span><span class="s"> http://weigou.baidu.com/topic/food</span><span class="k"> |</span><span class="nf"></span>
</span><span class='line'><span class="k">      |</span><span class="s"> http://weigou.baidu.com/topic/beauty</span><span class="k"> |</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>feature</code>文档使用的是<a href="https://github.com/cucumber/cucumber/wiki/Gherkin">Gerkins</a>的语法。以上这篇<code>feature</code>文档，使用了<code>Scenario Outline:</code>关键词，写了2个case。第一个是使用<code>Capybara</code>测死链，第二个是直接使用<code>http</code>客户端测死链。<code>Given</code>，<code>When</code>，<code>Then</code>三个关键词可以用来定义一个case所需要走的一个流程。（这个例子中省略了<code>Given</code>）这三个关键词后面的话都是可以根据case的需求改写的。<code>小黄瓜</code>会用这些话，用正则表达式自动对应到<code>feature/step_definitions/link_steps.rb</code>中每句话对应的<code>code block</code>中，并在测试时，运行每句话所对应的代码。</p>

<h1>代码讲解</h1>

<p>接下来讲解一下<code>feature/step_definitions/link_steps.rb</code>中的代码。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># encoding: utf-8</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 使用Capybara</span>
</span><span class='line'>
</span><span class='line'><span class="no">When</span> <span class="sr">/^我访问&quot;(.*?)&quot;并点击(.*)链接时$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="o">|</span>
</span><span class='line'>  <span class="c1"># 正则不仅将When关键词的话对应到这个code block中，</span>
</span><span class='line'>  <span class="c1"># 还能从那句话中读取参数。</span>
</span><span class='line'>  <span class="c1"># arg1的值是&quot;http://weigou.baidu.com&quot;</span>
</span><span class='line'>  <span class="c1"># arg2的值是&quot;团购&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># visit是capybara封装的一个函数。</span>
</span><span class='line'>  <span class="c1"># 他会自动打开火狐，并访问arg1。 </span>
</span><span class='line'>  <span class="n">visit</span> <span class="n">arg1</span>
</span><span class='line'>  <span class="c1"># find是capybara封装的一个函数。</span>
</span><span class='line'>  <span class="c1"># 这里通过html的a元素上的text找到了这个a元素，</span>
</span><span class='line'>  <span class="c1"># 并将他存到@elem变量中。</span>
</span><span class='line'>  <span class="vi">@elem</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="sr">/\A</span><span class="si">#{</span><span class="n">arg2</span><span class="si">}</span><span class="sr">\z/</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Then</span> <span class="sr">/^页面状态应该为&quot;(.*?)&quot;$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="o">|</span>
</span><span class='line'>  <span class="c1"># 点击该链接</span>
</span><span class='line'>  <span class="vi">@elem</span><span class="o">.</span><span class="n">click</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 使用http client</span>
</span><span class='line'>
</span><span class='line'><span class="no">When</span> <span class="sr">/^我访问(.*)链接时$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="o">|</span>
</span><span class='line'>  <span class="c1"># 由于在feature文档中使用了examples关键词</span>
</span><span class='line'>  <span class="c1"># 这里arg1分别对应了</span>
</span><span class='line'>  <span class="c1"># &quot;http://weigou.baidu.com/&quot;</span>
</span><span class='line'>  <span class="c1"># &quot;http://weigou.baidu.com/topic/food&quot;</span>
</span><span class='line'>  <span class="c1"># &quot;http://weigou.baidu.com/topic/beauty&quot;</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">arg1</span>
</span><span class='line'>  <span class="c1"># 直接使用http客户端，向每个arg1发送get请求。</span>
</span><span class='line'>  <span class="vi">@response</span> <span class="o">=</span> <span class="no">RestClient</span><span class="o">.</span><span class="n">get</span> <span class="n">arg1</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Then</span> <span class="sr">/^我得到的页面状态应该为&quot;(.*)&quot;$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="o">|</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">arg1</span>
</span><span class='line'>  <span class="c1"># 检查页面status是不是200。</span>
</span><span class='line'>  <span class="vi">@response</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里可以清楚的看到，在<code>feature</code>文档中，<code>When</code>和<code>Then</code>后面跟的话，都一一对应了一块代码。在运行自动化case时，他们会按照<code>feature</code>文档中每个<code>Scenario</code>的顺序，依次执行每一段对应的代码。</p>

<h1>附录</h1>

<ul>
<li>如有问题可以发送邮件至<a href="mailto:lengyu@baidu.com">lengyu@baidu.com</a>。</li>
<li><a href="https://s3.amazonaws.com/macslow/index.html">这个</a>挺有意思。</li>
</ul>


<object data="https://s3.amazonaws.com/macslow/clock7.svg?w=3&amp;h=3" id="clock1" type="image/svg+xml"></object>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何使用Jacoco远程统计tomcat服务的覆盖率]]></title>
    <link href="http://Fatman13.github.io/blog/2014/02/27/ru-he-shi-yong-jacocoyuan-cheng-tong-ji-tomcatfu-wu-de-fu-gai-lu/"/>
    <updated>2014-02-27T20:18:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2014/02/27/ru-he-shi-yong-jacocoyuan-cheng-tong-ji-tomcatfu-wu-de-fu-gai-lu</id>
    <content type="html"><![CDATA[<p>本文将简单介绍如何使用<code>Jacoco</code>生成远程<code>tomcat</code>服务的覆盖率报告。<br/>
(<em>注：使用<code>jacoco</code>打开远程服务端口，有一定安全风险。</em>)</p>

<!--more-->


<h1>软件安装</h1>

<ul>
<li><a href="http://ant.apache.org/bindownload.cgi">Ant</a></li>
<li><a href="http://www.eclemma.org/jacoco/">Jacoco</a></li>
</ul>


<h1>远程Tomcat服务配置</h1>

<ul>
<li><code>sh shutdown.sh</code>先关闭<code>tomcat</code>服务。</li>
<li>修改<code>bin/catalina.sh</code>中<code>JAVA_OPTS</code>的配置。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># -javaagent: 的后面跟jacoco的安装路径</span>
</span><span class='line'><span class="c"># includes= 选项，选择你要覆盖率的服务</span>
</span><span class='line'><span class="c"># port= 选项，选择你要打开的端口</span>
</span><span class='line'><span class="c"># address= 选项，tomcat服务所在机器的ip地址（如果想在跟tomcat服务同一台机器上执行ant任务的话，需要改为127.0.0.1）</span>
</span><span class='line'><span class="nv">JAVA_OPTS</span><span class="o">=</span><span class="s2">&quot;-javaagent:/path/to/your/jacoco_0.6.4/lib/jacocoagent.jar=includes=com.baidu.*,output=tcpserver,port=8893,address=10.81.14.77&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>sh startup.sh</code>重新启动<code>tomcat</code>服务。</li>
</ul>


<h1>本地Ant任务配置</h1>

<ul>
<li>配置<code>build.xml</code>。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; ?&gt;</span>
</span><span class='line'><span class="nt">&lt;project</span> <span class="na">name=</span><span class="s">&quot;Lengyu&quot;</span> <span class="na">xmlns:jacoco=</span><span class="s">&quot;antlib:org.jacoco.ant&quot;</span> <span class="na">default=</span><span class="s">&quot;jacoco&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="c">&lt;!--Jacoco的安装路径--&gt;</span>
</span><span class='line'>  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;jacocoantPath&quot;</span> <span class="na">value=</span><span class="s">&quot;/home/work/software/jacoco_0.6.4/lib/jacocoant.jar&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="c">&lt;!--最终生成.exec文件的路径，Jacoco就是根据这个文件生成最终的报告的--&gt;</span>
</span><span class='line'>  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;jacocoexecPath&quot;</span> <span class="na">value=</span><span class="s">&quot;/home/work/local/hudson_home/workspace/wg_merchant_oc_regression/jacoco.exec&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="c">&lt;!--生成覆盖率报告的路径--&gt;</span>
</span><span class='line'>  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;reportfolderPath&quot;</span> <span class="na">value=</span><span class="s">&quot;E:/Libs/coverage_ant_task/report/&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="c">&lt;!--远程tomcat服务的ip地址--&gt;</span>
</span><span class='line'>  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;server_ip&quot;</span> <span class="na">value=</span><span class="s">&quot;10.81.14.77&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="c">&lt;!--前面配置的远程tomcat服务打开的端口，要跟上面配置的一样--&gt;</span>
</span><span class='line'>  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;server_port&quot;</span> <span class="na">value=</span><span class="s">&quot;8893&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="c">&lt;!--源代码路径--&gt;</span>
</span><span class='line'>  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;checkOrderSrcpath&quot;</span> <span class="na">value=</span><span class="s">&quot;E:/Src/ordercenter/ordercenter-biz/src/main/java/&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="c">&lt;!--.class文件路径--&gt;</span>
</span><span class='line'>  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;checkOrderClasspath&quot;</span> <span class="na">value=</span><span class="s">&quot;E:/Src/ordercenter/ordercenter-biz/target/classes/com/baidu/ordercenter/service/Impl&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">&lt;!--让ant知道去哪儿找Jacoco--&gt;</span>
</span><span class='line'>  <span class="nt">&lt;taskdef</span> <span class="na">uri=</span><span class="s">&quot;antlib:org.jacoco.ant&quot;</span> <span class="na">resource=</span><span class="s">&quot;org/jacoco/ant/antlib.xml&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;classpath</span> <span class="na">path=</span><span class="s">&quot;${jacocoantPath}&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/taskdef&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">&lt;!--dump任务:</span>
</span><span class='line'><span class="c">      根据前面配置的ip地址，和端口号，</span>
</span><span class='line'><span class="c">      访问目标tomcat服务，并生成.exec文件。--&gt;</span>
</span><span class='line'>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;dump&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;jacoco:dump</span> <span class="na">address=</span><span class="s">&quot;${server_ip}&quot;</span> <span class="na">reset=</span><span class="s">&quot;false&quot;</span> <span class="na">destfile=</span><span class="s">&quot;${jacocoexecPath}&quot;</span> <span class="na">port=</span><span class="s">&quot;${server_port}&quot;</span> <span class="na">append=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/target&gt;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c">&lt;!--jacoco任务:</span>
</span><span class='line'><span class="c">      根据前面配置的源代码路径和.class文件路径，</span>
</span><span class='line'><span class="c">      根据dump后，生成的.exec文件，生成最终的html覆盖率报告。--&gt;</span>
</span><span class='line'>  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;report&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;delete</span> <span class="na">dir=</span><span class="s">&quot;${reportfolderPath}&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;mkdir</span> <span class="na">dir=</span><span class="s">&quot;${reportfolderPath}&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>      
</span><span class='line'>      <span class="nt">&lt;jacoco:report&gt;</span>
</span><span class='line'>          <span class="nt">&lt;executiondata&gt;</span>
</span><span class='line'>              <span class="nt">&lt;file</span> <span class="na">file=</span><span class="s">&quot;${jacocoexecPath}&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/executiondata&gt;</span>
</span><span class='line'>              
</span><span class='line'>          <span class="nt">&lt;structure</span> <span class="na">name=</span><span class="s">&quot;JaCoCo Report&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>              <span class="nt">&lt;group</span> <span class="na">name=</span><span class="s">&quot;Check Order related&quot;</span><span class="nt">&gt;</span>           
</span><span class='line'>                  <span class="nt">&lt;classfiles&gt;</span>
</span><span class='line'>                      <span class="nt">&lt;fileset</span> <span class="na">dir=</span><span class="s">&quot;${checkOrderClasspath}&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;/classfiles&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;sourcefiles</span> <span class="na">encoding=</span><span class="s">&quot;gbk&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                      <span class="nt">&lt;fileset</span> <span class="na">dir=</span><span class="s">&quot;${checkOrderSrcpath}&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>                  <span class="nt">&lt;/sourcefiles&gt;</span>
</span><span class='line'>              <span class="nt">&lt;/group&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/structure&gt;</span>
</span><span class='line'>
</span><span class='line'>          <span class="nt">&lt;html</span> <span class="na">destdir=</span><span class="s">&quot;${reportfolderPath}&quot;</span> <span class="na">encoding=</span><span class="s">&quot;utf-8&quot;</span> <span class="nt">/&gt;</span>         
</span><span class='line'>      <span class="nt">&lt;/jacoco:report&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/target&gt;</span>
</span><span class='line'><span class="nt">&lt;/project&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>生成覆盖率报告</h1>

<ul>
<li>执行<code>ant dump</code>。成功的话，应会有如下输出。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>[work@st01-ecom-jn2.st01.baidu.com ant]$ ant dump
</span><span class='line'>Buildfile: /home/work/local/hudson_home/workspace/wg_merchant_oc_regression/ant/build.xml
</span><span class='line'>
</span><span class='line'>dump:
</span><span class='line'>[jacoco:dump] Connecting to /10.81.14.77:8893
</span><span class='line'>[jacoco:dump] Dumping execution data to /home/work/local/hudson_home/workspace/wg_merchant_oc_regression/jacoco.exec
</span><span class='line'>
</span><span class='line'>BUILD SUCCESSFUL
</span><span class='line'>Total time: 0 seconds
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>最后执行<code>ant report</code>。<code>jacoco</code>就会在你指定的路径生成覆盖率报告了。</li>
</ul>


<h1>附录</h1>

<ul>
<li>更多关于<code>Jacocoagent</code>以及各种<code>task</code>可以参考<a href="http://www.eclemma.org/jacoco/trunk/doc/ant.html">官方文档</a></li>
<li><code>Jenkins</code>的<code>Jacoco plugin</code>可以根据<code>.exec</code>文件直接生成覆盖率报告，并在<code>Jenkins</code>中生成图表等等。那样的话，<code>ant report</code>这个任务就没用了。</li>
<li>如有问题，可发email至<a href="mailto:lengyu@baidu.com">lengyu@baidu.com</a>。</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何在没有外网的机器上安装gem]]></title>
    <link href="http://Fatman13.github.io/blog/2014/02/27/ru-he-zai-mei-you-wai-wang-de-ji-qi-shang-an-zhuang-gem/"/>
    <updated>2014-02-27T20:16:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2014/02/27/ru-he-zai-mei-you-wai-wang-de-ji-qi-shang-an-zhuang-gem</id>
    <content type="html"><![CDATA[<p>本文将简单介绍如何在没有外网的机器上安装<code>Cucumber</code>小黄瓜自动化测所需的<code>gem</code>库。</p>

<!--more-->


<h1>1. 软件安装（Jenkins机器）</h1>

<ul>
<li>安装<code>Jumbo</code>。</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bash -c "$( curl http://jumbo.baidu.com/install_jumbo.sh )"; source ~/.bashrc</span></code></pre></td></tr></table></div></figure>


<ul>
<li>安装<code>Ruby 1.9.3</code>。</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>jumbo install ruby</span></code></pre></td></tr></table></div></figure>


<ul>
<li>安装<code>svn</code>。</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>jumbo install subversion</span></code></pre></td></tr></table></div></figure>


<h1>2. 在无外网的Jenkins服务器（或者Slave机）上安装Gem</h1>

<ul>
<li>在jenkins机器上，选择一个合适的文件夹。从<code>svn</code>上下载小黄瓜所依赖的<code>gem</code>。</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>svn export https://svn.baidu.com/app-test/ecom/shifen/sf-crm/trunk/weigou/cuke_gems/</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>cd cuke_gems</code>至刚刚下载的文件夹中。运行如下指令，会先安装<code>bundler</code>这个<code>gem</code>。</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install --local bundler-1.3.4.gem</span></code></pre></td></tr></table></div></figure>


<ul>
<li>安装完成后，运行以下指令。</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bundle install --local </span></code></pre></td></tr></table></div></figure>


<h1>3. 添加新的Gem</h1>

<ul>
<li>如果需要添加新的gem的话，找一台有外网的机器。（如果Jenkins或者Slave机器是Linux机器，就得用Linux机器，是Windows就得用Windows机器。）</li>
<li>先<code>co</code>之前的<code>gem</code>库。</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>svn co https://svn.baidu.com/app-test/ecom/shifen/sf-crm/trunk/weigou/cuke_gems/</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>cd cuke_gems</code>至刚下载的文件夹中，修改<code>Gemfile</code>，添加新的<code>gem</code>。（最好能选定<code>gem</code>的版本）例如：</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">source</span> <span class="s1">&#39;http://rubygems.org&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;1.7.3&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;bundler&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.4&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 添加新Gem示例 &lt;------</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;new_gem&#39;</span><span class="p">,</span> <span class="s1">&#39;0.0.1&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;cucumber&#39;</span><span class="p">,</span> <span class="s1">&#39;1.2.1&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;rspec&#39;</span><span class="p">,</span> <span class="s1">&#39;2.11.0&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;httparty&#39;</span><span class="p">,</span> <span class="s1">&#39;0.8.3&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;rest-client&#39;</span><span class="p">,</span> <span class="s1">&#39;1.6.7&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>添加完成后，运行<code>bundle install</code>，然后运行<code>bundle package</code>。这样<code>bundler</code>就会生成新添加的<code>gem</code>的<code>.gem</code>文件以提供本地安装了。</li>
<li>把更新后的代码提交至<code>svn</code>。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">svn</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;add new gem(s)&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>最后重复上文第2大点中的步骤，就能更新Jenkins机器上的<code>gem</code>库了。</li>
</ul>


<h1>附录</h1>

<ul>
<li><code>bundler</code>是给<code>gem</code>打包的一个<code>gem</code>，所以在上文中先安装了<code>bundler</code>，然后让<code>bundler</code>去本地安装其他的<code>gem</code>。</li>
<li>更多关于<code>Gemfile</code>的使用方法，可以参考<a href="http://bundler.io/">官方网站</a>。</li>
<li>所有<code>.gem</code>文件都可以在<a href="http://rubygems.org/">rubygems.org</a>上下载到。其中包括<code>gem</code>的所有历史版本。</li>
<li>如有更多问题，发送email至<a href="mailto:lengyu@baidu.com">lengyu@baidu.com</a>。</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[测试桩使用指南]]></title>
    <link href="http://Fatman13.github.io/blog/2014/02/19/ce-shi-zhuang-shi-yong-zhi-nan/"/>
    <updated>2014-02-19T21:35:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2014/02/19/ce-shi-zhuang-shi-yong-zhi-nan</id>
    <content type="html"><![CDATA[<p>本文将简单介绍<code>测试桩</code>现有的一些功能以及如何使用<code>测试桩</code>提供的<code>API</code>接口。</p>

<!--more-->


<h1>测试桩简介</h1>

<p>现在测试桩使用<code>Django</code>框架，大致分为<code>mysite</code>，<code>jsonrpc</code>，<code>scaffolding</code>这3个模块。<br/>
（注：在项目的根目录使用了<code>python manage.py startapp [模块名]</code>这个命令创建了这些模块，模块化<code>Django</code>提供的服务）</p>

<ul>
<li><code>mysite</code>是项目的第一个模块。主要提供了kv以及商品库的几个接受jsonrpc请求的接口。<code>mysite</code>下的<code>urls.py</code>是定义<code>测试桩</code>各项API接口url的主入口。</li>
<li><code>jsonrpc</code>提供了几个发送jsonrpc请求的接口（mcpack封装），还有发送通用的jsonrpc请求的接口。（无mcpack封装，vanilla版jsonrpc请求）</li>
<li><code>scaffolding</code>主要负责提供制造各种mock商品的接口，便于自动化case的setup中，制造case所需的mock商品。</li>
</ul>


<h1>Chrome插件</h1>

<p>使用<code>chrome</code>的<code>cRest Client</code>插件可以手动向<code>测试桩</code>发送各种请求。</p>

<p><img src="http://i.imgur.com/oJEztF2.jpg" alt="" /></p>

<h1>Jsonrpc工具</h1>

<p>输入<code>测试桩</code>商品库地址<code>http://st01-ecom-jn2.st01.baidu.com:8890/serviceAPI/api</code>，选择api，method，并填入请求参数就可以手动给<code>测试桩</code>发送jsonrpc请求了。jsonrpc工具可在附件中下载。</p>

<p><img src="http://i.imgur.com/ALJTrbi.jpg" alt="" /></p>

<h1>1. Mysite接口</h1>

<p>（可试用jsonrpc工具手动访问这些接口，或者使用renliang开发的jsonrpc-client）</p>

<h3>1.1 ProductAPI/queryInfo 获取商品详情</h3>

<ul>
<li><a href="http://st01-ecom-jn2.st01.baidu.com:8890/serviceAPI/api">http://st01-ecom-jn2.st01.baidu.com:8890/serviceAPI/api</a></li>
<li>ProductAPI</li>
<li>queryInfo</li>
<li>{&ldquo;products&rdquo;:[&ldquo;183019616&rdquo;],&ldquo;uc_id&rdquo;:29844}</li>
</ul>


<h3>1.2 PromotionAPI/query 获取促销详情</h3>

<ul>
<li><a href="http://st01-ecom-jn2.st01.baidu.com:8890/serviceAPI/api">http://st01-ecom-jn2.st01.baidu.com:8890/serviceAPI/api</a></li>
<li>PromotionAPI</li>
<li>query</li>
<li>{&ldquo;promotion_id&rdquo;:&ldquo;3000&rdquo;,&ldquo;uc_id&rdquo;:29844}</li>
</ul>


<h3>1.3 StockAPI/updateIncrement 增减库存</h3>

<ul>
<li><a href="http://st01-ecom-jn2.st01.baidu.com:8890/serviceAPI/api">http://st01-ecom-jn2.st01.baidu.com:8890/serviceAPI/api</a></li>
<li>StockAPI</li>
<li>updateIncrement</li>
<li>{&ldquo;uc_id&rdquo;:6195321,&ldquo;products&rdquo;:[{&ldquo;product_id&rdquo;:&ldquo;600528576&rdquo;,&ldquo;items&rdquo;:[{&ldquo;stock&rdquo;:-2,&ldquo;region&rdquo;:&ldquo;全国&rdquo;}]}]}</li>
</ul>


<h3>1.4 PromotionAPI/updateStockInc 增减促销库存</h3>

<ul>
<li><a href="http://st01-ecom-jn2.st01.baidu.com:8890/serviceAPI/api">http://st01-ecom-jn2.st01.baidu.com:8890/serviceAPI/api</a></li>
<li>PromotionAPI</li>
<li>updateStockInc</li>
<li>{&ldquo;uc_id&rdquo;: 29844,&ldquo;product_outerid&rdquo;:&ldquo;F47&rdquo;,&ldquo;promotion_id&rdquo;:37,&ldquo;stock_inc&rdquo;:5}</li>
</ul>


<h1>2. kv接口</h1>

<p>（kv接口主要应用于验单时，查询该商品是否存在。新kv接口是一个新的技术优化，与老kv接口还并存着。。。）</p>

<h3>2.1 新kv接口</h3>

<p><a href="http://st01-ecom-jn2.st01.baidu.com:8890/serviceAPI/midpage/product/details?ids=183019611">http://st01-ecom-jn2.st01.baidu.com:8890/serviceAPI/midpage/product/details?ids=183019611</a></p>

<h3>2.2 老kv接口</h3>

<p><a href="http://st01-ecom-jn2.st01.baidu.com:8890/api/midpage/product/details?ids=183019611">http://st01-ecom-jn2.st01.baidu.com:8890/api/midpage/product/details?ids=183019611</a></p>

<h1>3. Scaffolding接口</h1>

<p>（主要用于各种商品库接口的mock数据的制造，便于自动化case的setup。）</p>

<h3>3.1 制造kv接口的返回值</h3>

<ul>
<li><a href="http://st01-ecom-jn2.st01.baidu.com:8890/scaffolding/create/kv?product_id=77582589&amp;stock=0&amp;promotionId=1013">http://st01-ecom-jn2.st01.baidu.com:8890/scaffolding/create/kv?product_id=77582589&amp;stock=0&amp;promotionId=1013</a></li>
<li>(可以跟更多参数。参照<code>mysite/response/new_KV/new_kv_template.json</code>。)</li>
</ul>


<h3>3.2 制造老kv接口的返回值（老kv）</h3>

<ul>
<li><a href="http://st01-ecom-jn2.st01.baidu.com:8890/scaffolding/create/oldkv?product_id=77582589&amp;merchantId=298440&amp;newPrice=100.00">http://st01-ecom-jn2.st01.baidu.com:8890/scaffolding/create/oldkv?product_id=77582589&amp;merchantId=298440&amp;newPrice=100.00</a></li>
<li>(可以跟更多参数。参照<code>mysite/response/KV/kv_template.json</code>。)</li>
</ul>


<h3>3.3 制造queryInfo接口的返回值</h3>

<ul>
<li><a href="http://st01-ecom-jn2.st01.baidu.com:8890/scaffolding/create/ProductAPI/queryInfo?product_id=77582589&amp;active=0&amp;fid=1157">http://st01-ecom-jn2.st01.baidu.com:8890/scaffolding/create/ProductAPI/queryInfo?product_id=77582589&amp;active=0&amp;fid=1157</a></li>
<li>(可以跟更多参数。参照<code>mysite/response/ProductAPI/queryInfo/queryInfo_template.json</code>。)</li>
</ul>


<h3>3.4 制造query接口的返回值</h3>

<ul>
<li><a href="http://st01-ecom-jn2.st01.baidu.com:8890/scaffolding/create/PromotionAPI/query?product_id=77582589&amp;active=0&amp;fid=1157">http://st01-ecom-jn2.st01.baidu.com:8890/scaffolding/create/PromotionAPI/query?product_id=77582589&amp;active=0&amp;fid=1157</a></li>
<li>(可以跟更多参数。参照<code>mysite/response/PromotionAPI/query/query_template.json</code>。)</li>
</ul>


<h1>4. Jsonrpc接口</h1>

<p>（用post方法，带着参数，访问这些接口。<code>测试桩</code>会代为发送jsonrpc请求，相当于一个接口级的jsonrpc工具。推荐使用上文提到的Chrome中<code>cRest Client</code>这个插件。使用post方法的话，Request entity中放请求的json串，或者其他参数。）</p>

<h3>4.1 vanilla示例（无mcpack封装，支持大多数jsonrpc的api）</h3>

<ul>
<li><a href="http://st01-ecom-jn2.st01.baidu.com:8890/jsonrpc/vanilla/ProductAPI/queryInfo">http://st01-ecom-jn2.st01.baidu.com:8890/jsonrpc/vanilla/ProductAPI/queryInfo</a></li>
<li>{&ldquo;products&rdquo;:[&ldquo;183019611&rdquo;],&ldquo;uc_id&rdquo;:29844}</li>
</ul>


<h3>4.2 jsonrpc示例（有mcpack封装，只支持个别jsonrpc的api）</h3>

<h4>4.2.1 OrderInnerAPI/daigouCreateOrder（代购api）</h4>

<ul>
<li><a href="http://st01-ecom-jn2.st01.baidu.com:8890/jsonrpc/send/OrderInnerAPI/daigouCreateOrder">http://st01-ecom-jn2.st01.baidu.com:8890/jsonrpc/send/OrderInnerAPI/daigouCreateOrder</a></li>
<li>{&ldquo;daigouOrder&rdquo;:{&ldquo;daigouId&rdquo;:1,&ldquo;passportId&rdquo;:&ldquo;1245&rdquo;,&ldquo;productIds&rdquo;:&ldquo;181835090&rdquo;,&ldquo;productCounts&rdquo;:&ldquo;1&rdquo;,&ldquo;customer&rdquo;:&ldquo;木根&rdquo;,&ldquo;mobile&rdquo;:&ldquo;12383846326&rdquo;,&ldquo;payStyle&rdquo;:&ldquo;DAIGOU&rdquo;,&ldquo;province&rdquo;:&ldquo;山东&rdquo;,&ldquo;city&rdquo;:&ldquo;济南市&rdquo;,&ldquo;district&rdquo;:&ldquo;大观区&rdquo;,&ldquo;town&rdquo;:&ldquo;白贤镇&rdquo;,&ldquo;districtId&rdquo;:&ldquo;120001&rdquo;,&ldquo;detailAddress&rdquo;:&ldquo;龙山路22号&rdquo;,&ldquo;needInvoice&rdquo;:&ldquo;true&rdquo;,&ldquo;invoiceTitle&rdquo;:&ldquo;百度中国&rdquo;},&ldquo;token&rdquo;:&ldquo;daigou_token_26e588a503074&rdquo;}</li>
</ul>


<h4>4.2.2 PostageAPI/addTemplate（添加运费模板api）</h4>

<ul>
<li><a href="http://st01-ecom-jn2.st01.baidu.com:8890/jsonrpc/send/PostageAPI/addTemplate">http://st01-ecom-jn2.st01.baidu.com:8890/jsonrpc/send/PostageAPI/addTemplate</a></li>
<li>{&ldquo;name&rdquo;:&ldquo;运费模板名称&rdquo;,&ldquo;ucId&rdquo;:29844,&ldquo;outerId&rdquo;:null,&ldquo;assumer&rdquo;:&ldquo;SELLER&rdquo;,&ldquo;valuation&rdquo;:&ldquo;QUANTITY&rdquo;,&ldquo;consignAreaId&rdquo;:&ldquo;110101&rdquo;,&ldquo;lastModify&rdquo;:&ldquo;2014-01-02 19:06:01&rdquo;,&ldquo;shippingMethodList&rdquo;:[{&ldquo;name&rdquo;:&ldquo;COD&rdquo;,&ldquo;defaultStartStandards&rdquo;:&ldquo;1&rdquo;,&ldquo;defaultStartFees&rdquo;:&ldquo;10.00&rdquo;,&ldquo;defaultAddStandards&rdquo;:&ldquo;1&rdquo;,&ldquo;defaultAddFees&rdquo;:&ldquo;4.00&rdquo;,&ldquo;regionGroupList&rdquo;:[]}]}</li>
</ul>


<h4>4.2.3 PostageAPI/deleteTemplate（删除运费模板api）</h4>

<ul>
<li><a href="http://st01-ecom-jn2.st01.baidu.com:8890/jsonrpc/send/PostageAPI/deleteTemplate">http://st01-ecom-jn2.st01.baidu.com:8890/jsonrpc/send/PostageAPI/deleteTemplate</a></li>
<li>109</li>
</ul>


<h4>4.2.4 DeliveryRegionsAPI/updateDeliveryRegions（更新配送范围api）</h4>

<ul>
<li><a href="http://st01-ecom-jn2.st01.baidu.com:8890/jsonrpc/send/DeliveryRegionsAPI/updateDeliveryRegions">http://st01-ecom-jn2.st01.baidu.com:8890/jsonrpc/send/DeliveryRegionsAPI/updateDeliveryRegions</a></li>
<li>0</li>
</ul>


<h1>总结</h1>

<p>如有问题可以发送邮件至<a href="mailto:lengyu@baidu.com">lengyu@baidu.com</a>。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何整合Cucumber小黄瓜至Jenkins持续集成服务器]]></title>
    <link href="http://Fatman13.github.io/blog/2014/02/17/ru-he-zheng-he-cucumberxiao-huang-gua-zhi-jenkinschi-xu-ji-cheng-fu-wu-qi/"/>
    <updated>2014-02-17T21:18:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2014/02/17/ru-he-zheng-he-cucumberxiao-huang-gua-zhi-jenkinschi-xu-ji-cheng-fu-wu-qi</id>
    <content type="html"><![CDATA[<p>本文将简单介绍如何将<code>Cucumber</code>小黄瓜的测试case整合到你的<code>Jenkins CI服务器</code>中。</p>

<!--more-->


<h1>软件安装</h1>

<p>以Windows工作机为例<br/>
&ndash; JDK或者JRE（记得设置JAVA_HOME这个环境变量）<br/>
&ndash; git（如果你已经安装了<a href="http://railsinstaller.org/">RailsInstaller</a>，里面是包含git的）<br/>
&ndash; 下载最新稳定版的<a href="http://mirrors.jenkins-ci.org/war/latest/jenkins.war">Jenkins</a></p>

<h1>本地建立git代码库</h1>

<p>下载，解压源代码，打开命令行，cd至刚解压的文件夹中，运行以下命令。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git init
</span><span class='line'>git add .
</span><span class='line'>git commit -m "initial commit"</span></code></pre></td></tr></table></div></figure>


<h1>本地配置和运行Jenkins</h1>

<ul>
<li>拷贝<code>Jenkins</code>的<code>war包</code>至你想要的文件夹，打开命令行，cd至那个文件夹。</li>
<li>运行<code>java -Dfile.encoding=UTF-8 -jar jenkins.war</code>。</li>
<li>在网页浏览器中打开<code>http://localhost:8080/configureSecurity/</code>，按下图中的配置以后点击<code>Save</code>。</li>
</ul>


<p><img src="http://i.imgur.com/ea5IK3k.jpg" alt="" /></p>

<ul>
<li>打开<code>http://localhost:8080/pluginManager/available</code>，勾选<code>Source Code Management</code>下的<code>Git Plugin</code>和<code>Build Tools</code>下的<code>Rake plugin</code>。点击<code>Download now and install after restart</code>。</li>
<li>等待Jenkins安装插件，失败的话再重新装。安装完成后<code>ctrl+c</code>杀掉进程，并重新运行<code>Jenkins</code>。</li>
<li>打开<code>http://localhost:8080/view/All/newJob</code>。填入你想要的Job名称，选择<code>Build a free-style software project</code>。点击<code>OK</code>。</li>
<li>打开<code>http://localhost:8080/job/[job名称]/configure</code>。</li>
<li>在<code>Source Code Management</code>下，选择<code>Git</code>。并在<code>Repository URL</code>中填上小黄瓜case所在的文件夹地址。如下图。</li>
</ul>


<p><img src="http://i.imgur.com/OVjhttE.jpg" alt="" /></p>

<ul>
<li>在<code>Build Triggers</code>中勾选<code>Trigger builds remotely</code>。填一个你喜欢的token。这样这个job就可以被远程执行了。以下图为例，在浏览器中输入<code>http://localhost:8080/job/wg_merchant_oc_regression/build?token=lengyu</code>就能执行这个job了。</li>
</ul>


<p><img src="http://i.imgur.com/YhfCOzS.jpg" alt="" /></p>

<ul>
<li>在<code>Build</code>下，点击<code>Add Build Step</code>，并选择<code>Invoke Rake</code>。点击<code>Advanced</code>。配置如下图。<code>features</code>是一个<code>rake task</code>，需要在前面<code>Repository URL</code>目录中配置<code>Rakefile</code>，参见上传的代码。</li>
</ul>


<p><img src="http://i.imgur.com/V7AfNPc.jpg" alt="" /></p>

<h1>总结</h1>

<p>在<code>git plugin</code>和<code>rake plugin</code>的帮助下，轻轻松松就能将小黄瓜整合到<code>jenkins</code>中。如有问题可发送邮件至<a href="mailto:lengu@baidu.com">lengyu@baidu.com</a>。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何使用Cucumber小黄瓜做结算中心数据校验自动化]]></title>
    <link href="http://Fatman13.github.io/blog/2014/02/15/ru-he-shi-yong-cucumberxiao-huang-gua-zuo-jie-suan-zhong-xin-shu-ju-xiao-yan-zi-dong-hua/"/>
    <updated>2014-02-15T15:53:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2014/02/15/ru-he-shi-yong-cucumberxiao-huang-gua-zuo-jie-suan-zhong-xin-shu-ju-xiao-yan-zi-dong-hua</id>
    <content type="html"><![CDATA[<p>本文将简单介绍如何使用<code>小黄瓜</code>来实结算中心数据比对的自动化。如果你对小黄瓜还没有初步认识的话，推荐阅读我之前写的一篇<a href="http://tauntaunslayer13.me/blog/2014/01/26/ru-he-shi-yong-capybarahe-cucumbershi-xian-ye-mian-ji-bie-zi-dong-hua/">文章</a>。</p>

<!--more-->


<h1>运行自动化</h1>

<p>按照惯例，下载代码，解压，打开命令行，切换到解压后的文件夹中。<br/>
运行<code>bundle install</code>。<br/>
运行<code>cucumber features/wgpc_sc.feature</code>，运行成功的话，应该能看见如下输出。</p>

<p><img src="http://i.imgur.com/oPyqlVY.jpg" alt="" /></p>

<p>注意这个case挂掉了，因为<code>jianzhong</code>2月14号的数据跟线上数据校验后有出入。输出中浅蓝色的字体（{&ldquo;540&rdquo;=>[46.0, 0.0]}）为账户金额有出入的商家id以及<code>jianzhong</code>与线上数据金额的差额。</p>

<h1>feature文档</h1>

<p>这次的feature文档简单很多。如对feature文档中的关键词存有疑惑，可参考我之前写的这篇<a href="http://tauntaunslayer13.me/blog/2014/02/13/ru-he-shi-yong-xiao-huang-gua-lai-zuo-jie-kou-ji-ce-shi/">文章</a>。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='cucumber'><span class='line'><span class="k">Feature:</span><span class="nf"> 比对结算数据</span>
</span><span class='line'><span class="nf">  为了保证结算数据中各个资金帐户余额的准确性，跟建忠计算的数据进行验对。</span>
</span><span class='line'>
</span><span class='line'><span class="nf">  </span><span class="k">Scenario:</span><span class="nf"> 校验逻辑</span>
</span><span class='line'><span class="k">    Given </span><span class="nf">我读取&quot;</span><span class="s">./data/sc/2014-02-13.xls</span><span class="nf">&quot;建忠excel文件中的数据</span>
</span><span class='line'><span class="nf">    </span><span class="k">And </span><span class="nf">我打开&quot;</span><span class="s">http://settlement.weigou.baidu.com/macount/account_info?merchantId=</span><span class="nf">&quot;线上结算中心网站并抓取结算数据</span>
</span><span class='line'><span class="nf">    </span><span class="k">When </span><span class="nf">我比对这二组数据</span>
</span><span class='line'><span class="nf">    </span><span class="k">Then </span><span class="nf">我将会生成校验报告并评估此次校验</span>
</span></code></pre></td></tr></table></div></figure>


<p>整个比对过程大致为，打开<code>jianzhong</code>的excel文件，打开线上的结算中心，并抓取线上结算中心网页上的数据，并跟<code>jianzhong</code>的数据进行比对，如有出入，打印有出入的商家id以及2份数据余额的差额并断言。（注：本来想自动发email的，但是mail这个gem所依赖的mime-type这个gem跟cucumber也不知道是capybara用到的mime-type的版本好像有冲突。望高人留言指点。）</p>

<h1>代码详解</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Given</span> <span class="sr">/^我读取&quot;(.*?)&quot;建忠excel文件中的数据$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">excel_file</span><span class="o">|</span>
</span><span class='line'>  <span class="c1"># 使用spreadsheet这个gem来读取xls文件</span>
</span><span class='line'>  <span class="n">sc_file</span> <span class="o">=</span> <span class="no">Spreadsheet</span><span class="o">.</span><span class="n">open</span> <span class="n">excel_file</span>
</span><span class='line'>  <span class="c1"># 选择记录各资金账户余额的一张sheet</span>
</span><span class='line'>  <span class="n">sc_sheet</span> <span class="o">=</span> <span class="n">sc_file</span><span class="o">.</span><span class="n">worksheet</span> <span class="mi">2</span>
</span><span class='line'>  <span class="c1"># @sc_data_jianzhong以商家id为key，对应value为长度为2的一个数组</span>
</span><span class='line'>  <span class="c1"># 数组中第1个值为用户担保帐余额，第2个是待结算账户余额</span>
</span><span class='line'>  <span class="vi">@sc_data_jianzhong</span> <span class="o">=</span> <span class="no">Hash</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="c1"># 读取每一行</span>
</span><span class='line'>  <span class="n">sc_sheet</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
</span><span class='line'>    <span class="c1"># 跳过第一行，其实不跳也没关系</span>
</span><span class='line'>    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">1</span>
</span><span class='line'>      <span class="k">next</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="c1"># row[2]就是用户担保帐余额，row[3]是待结算账户余额</span>
</span><span class='line'>    <span class="vi">@sc_data_jianzhong</span><span class="o">[</span><span class="n">row</span><span class="o">[</span><span class="mi">0</span><span class="o">]]</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="vi">@sc_data_jianzhong</span><span class="o">[</span><span class="n">row</span><span class="o">[</span><span class="mi">0</span><span class="o">]]</span> <span class="o">&lt;&lt;</span> <span class="n">row</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@sc_data_jianzhong</span><span class="o">[</span><span class="n">row</span><span class="o">[</span><span class="mi">0</span><span class="o">]]</span> <span class="o">&lt;&lt;</span> <span class="n">row</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>从excel文件里面读取<code>jianzhong</code>结算的结算数据，并保存到<code>@sc_data_jianzhong</code>这个变量中。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Given</span> <span class="sr">/^我打开&quot;(.*?)&quot;线上结算中心网站并抓取结算数据$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">sc_url</span><span class="o">|</span>
</span><span class='line'>  <span class="c1"># 访问结算中心线上环境</span>
</span><span class='line'>  <span class="n">visit</span> <span class="n">sc_url</span>
</span><span class='line'>  <span class="c1"># 算一下一共有多少行商家</span>
</span><span class='line'>  <span class="n">count</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="s1">&#39;table tr&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span>
</span><span class='line'>  <span class="vi">@sc_data_yanghu</span> <span class="o">=</span> <span class="no">Hash</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="c1"># 有多少行，就loop多少次</span>
</span><span class='line'>  <span class="n">count</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="c1"># 跳过第一行，其实也可以不跳</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>      <span class="k">next</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="c1"># 用xpath选到每一行，拿他的text。</span>
</span><span class='line'>    <span class="n">row</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="ss">:xpath</span><span class="p">,</span> <span class="s2">&quot;(//tr)[&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_s</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span>
</span><span class='line'>    <span class="vi">@sc_data_yanghu</span><span class="o">[</span><span class="n">row</span><span class="o">[</span><span class="mi">1</span><span class="o">]]</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="c1"># row[4]为用户担保帐余额，row[5]为待结算账户余额</span>
</span><span class='line'>    <span class="vi">@sc_data_yanghu</span><span class="o">[</span><span class="n">row</span><span class="o">[</span><span class="mi">1</span><span class="o">]]</span> <span class="o">&lt;&lt;</span> <span class="n">row</span><span class="o">[</span><span class="mi">4</span><span class="o">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="o">[</span><span class="mi">4</span><span class="o">].</span><span class="n">length</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@sc_data_yanghu</span><span class="o">[</span><span class="n">row</span><span class="o">[</span><span class="mi">1</span><span class="o">]]</span> <span class="o">&lt;&lt;</span> <span class="n">row</span><span class="o">[</span><span class="mi">5</span><span class="o">][</span><span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="o">[</span><span class="mi">5</span><span class="o">].</span><span class="n">length</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>使用<code>selenium-webdriver</code>配合<code>capybara</code>打开结算中心线上环境。并抓取页面上的数据，保存至<code>@sc_data_yanghu</code>这个参数中。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">When</span> <span class="sr">/^我比对这二组数据$/</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># 数据比对结果</span>
</span><span class='line'>  <span class="vi">@result</span> <span class="o">=</span> <span class="no">Hash</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="c1"># 比对@sc_data_yanghu和@sc_data_jianzhong，写的比较死，不是最灵活</span>
</span><span class='line'>  <span class="vi">@sc_data_yanghu</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
</span><span class='line'>    <span class="k">if</span> <span class="vi">@sc_data_jianzhong</span><span class="o">.</span><span class="n">has_key?</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="vi">@sc_data_jianzhong</span><span class="o">[</span><span class="n">key</span><span class="o">][</span><span class="mi">0</span><span class="o">].</span><span class="n">to_f</span> <span class="o">!=</span> <span class="n">value</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_f</span> <span class="o">||</span> <span class="vi">@sc_data_jianzhong</span><span class="o">[</span><span class="n">key</span><span class="o">][</span><span class="mi">1</span><span class="o">].</span><span class="n">to_f</span> <span class="o">!=</span> <span class="n">value</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_f</span>
</span><span class='line'>        <span class="vi">@result</span><span class="o">[</span><span class="n">key</span><span class="o">]</span> <span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>        <span class="c1"># 现在想来可能这个delete(&#39;,&#39;)的处理放在上面可能比较好。</span>
</span><span class='line'>        <span class="vi">@result</span><span class="o">[</span><span class="n">key</span><span class="o">]</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="vi">@sc_data_jianzhong</span><span class="o">[</span><span class="n">key</span><span class="o">][</span><span class="mi">0</span><span class="o">].</span><span class="n">to_f</span> <span class="o">-</span> <span class="n">value</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_f</span><span class="p">)</span>
</span><span class='line'>        <span class="vi">@result</span><span class="o">[</span><span class="n">key</span><span class="o">]</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="vi">@sc_data_jianzhong</span><span class="o">[</span><span class="n">key</span><span class="o">][</span><span class="mi">1</span><span class="o">].</span><span class="n">to_f</span> <span class="o">-</span> <span class="n">value</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_f</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>比对@sc_data_yanghu和@sc_data_jianzhong里面的数据，如果数据有出入的话，保存商家id至<code>@result</code>中，然后计算2份数据之间的差额，差额越大bug的可能性也越大，大概。。。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Then</span> <span class="sr">/^我将会生成校验报告并评估此次校验$/</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># 本来想自动发email的，但是这个mail的依赖好像有冲突，求高人指点</span>
</span><span class='line'>  <span class="c1"># Mail.deliver do</span>
</span><span class='line'>  <span class="c1">#   from     &#39;qa-automation@baidu.com&#39;</span>
</span><span class='line'>  <span class="c1">#   to       &#39;lengyu@baidu.com&#39;</span>
</span><span class='line'>  <span class="c1">#   subject  &#39;【结算中心线上数据与建忠数据比对结果】&#39;</span>
</span><span class='line'>  <span class="c1">#   body     @result.to_s</span>
</span><span class='line'>  <span class="c1">#   # add_file &#39;/full/path/to/somefile.png&#39;</span>
</span><span class='line'>  <span class="c1"># end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># 打印结果</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="vi">@result</span>
</span><span class='line'>  <span class="c1"># 断言，@result应该为空。</span>
</span><span class='line'>  <span class="vi">@result</span><span class="o">.</span><span class="n">should</span> <span class="n">be_empty</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>最后看<code>@result</code>是否为空，不是的话，就需要断言。说明2份数据有出入。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何使用小黄瓜来做接口级自动化测试]]></title>
    <link href="http://Fatman13.github.io/blog/2014/02/13/ru-he-shi-yong-xiao-huang-gua-lai-zuo-jie-kou-ji-ce-shi/"/>
    <updated>2014-02-13T21:08:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2014/02/13/ru-he-shi-yong-xiao-huang-gua-lai-zuo-jie-kou-ji-ce-shi</id>
    <content type="html"><![CDATA[<p>本文将简单介绍如何使用<code>小黄瓜</code>来实现接口级别的自动化测试。如果你还没有对小黄瓜有初步认识的话，推荐阅读我之前写的一篇<a href="http://tauntaunslayer13.me/blog/2014/01/26/ru-he-shi-yong-capybarahe-cucumbershi-xian-ye-mian-ji-bie-zi-dong-hua/">文章</a>。</p>

<!--more-->


<h1>运行自动化</h1>

<p>下载代码，解压，打开命令行，切换到解压后的文件夹中，运行<code>bundle install</code>。<br/>
运行<code>cucumber features/wgpc_check_kai.feature</code>，运行成功的话，应该能看见如下输出。</p>

<p><img src="http://i.imgur.com/ghYr3bJ.jpg" alt="" /></p>

<p>以及其他的一些case等等&hellip;</p>

<h1>feature文档</h1>

<p>用<code>小黄瓜</code>写测试case的第一步就是写case的feature文档。<br/>
例如：<code>cuke_oc\features\wgoc_check_kai.feature</code>。<br/>
<code>小黄瓜</code>的feature文档使用<a href="https://github.com/cucumber/cucumber/wiki/Gherkin">Gherkin</a>格式来更好的帮你理解，管理和维护你的case。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='cucumber'><span class='line'><span class="nt">@checkorder</span><span class="nf"></span>
</span><span class='line'><span class="k">Feature:</span><span class="nf"> Check Order</span>
</span><span class='line'><span class="nf">  为了保证订单的准确性，在提交订单之前，对订单进行验对。</span>
</span><span class='line'>
</span><span class='line'><span class="nf">  </span><span class="k">Background:</span><span class="nf"></span>
</span><span class='line'><span class="k">    Given </span><span class="nf">我根据&quot;</span><span class="s">./data/wgoc_cases/shipping_region.txt</span><span class="nf">&quot;设置配送范围</span>
</span><span class='line'>
</span><span class='line'><span class="nf">  </span><span class="k">Scenario Outline:</span><span class="nf"> 验单逻辑</span>
</span><span class='line'><span class="k">    Given </span><span class="nf">我根据 </span><span class="nv">&lt;mprpc_data_file&gt;</span><span class="nf"> 文件中的配置建立运费信息</span>
</span><span class='line'><span class="nf">    </span><span class="k">And </span><span class="nf">我根据 </span><span class="nv">&lt;mock_data_file&gt;</span><span class="nf"> 文件中的配置制造mock商品信息</span>
</span><span class='line'><span class="nf">    </span><span class="k">And </span><span class="nf">我从 </span><span class="nv">&lt;request_data_file&gt;</span><span class="nf"> 文件中读取某http请求</span>
</span><span class='line'><span class="nf">    </span><span class="k">When </span><span class="nf">我用post方法发送该请求至oc的话</span>
</span><span class='line'><span class="nf">    </span><span class="k">Then </span><span class="nf">我将得到与 </span><span class="nv">&lt;response_data_file&gt;</span><span class="nf"> 文件中相同的json串</span>
</span><span class='line'>
</span><span class='line'><span class="nf">  </span><span class="k">Examples:</span><span class="nf"> case_1: 默认全国10块, 非促销商品验单成功（购买1件&amp;支持配送&lt;上海&amp;北京&amp;天津&gt;&amp;未绑定运费模板）</span><span class="k"></span>
</span><span class='line'><span class="k">    |</span><span class="nv"> mprpc_data_file</span><span class="k"> |</span><span class="nv"> mock_data_file</span><span class="k"> |</span><span class="nv"> request_data_file</span><span class="k"> |</span><span class="nv"> response_data_file</span><span class="k"> |</span><span class="nf"></span>
</span><span class='line'><span class="k">    |</span><span class="s"> empty.json</span><span class="k"> |</span><span class="s"> check_mock_1.yaml</span><span class="k"> |</span><span class="s"> check_request_1.yaml</span><span class="k"> |</span><span class="s"> check_response_1.json</span><span class="k"> |</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>Feature</code>关键词：简单介绍你要测试的feature。<code>Feature: Check Order</code>的下一行可以跟任意长度的更为详细的功能摘要。一个<code>Feature</code>能包含多个<code>Scenario</code>。（以上例子只有一个<code>Scenario</code>）</li>
<li><code>Backgroud</code>关键词：定义一个全局的setup的步骤。<code>Background</code>对应的代码，整个feature只运行一次。</li>
<li><code>Scenario Outline</code>关键词：配合<code>&lt;&gt;</code>括号内的变量与<code>Examples</code>关键词，用<code>Examples</code>下面的表格中定义的具体数值来对应到<code>&lt;&gt;</code>括号中的变量中的位置。（以上面为例，当这个<code>Scenario</code>被执行的时候，<code>&lt;mprpc_data_file&gt;</code>这个参数的数值，就会被<code>Examples</code>中，<code>mprpc_data_file</code>栏中的<code>empty.json</code>替代。）</li>
<li><code>Given</code>关键词：定义case执行时所要做的一些准备工作。</li>
<li><code>When</code>关键词：定义case执行时所要做一个关键动作。</li>
<li><code>Then</code>关键词：定义case执行后，校验工作，一般断言都放在这里。</li>
<li><code>@checkorder</code>关键词：其实这个也不能算是关键词，<code>@checkorder</code>定义了这个feature会使用名为<code>@checkorder</code>的一个hook。hook定义了这个feature在case级别的setup/teardown应该执行哪儿些代码。</li>
</ul>


<h1>code block生成</h1>

<p>有了feature文档以后，运行<code>cucumber features/wgpc_check_kai.feature</code>，<code>小黄瓜</code>会帮你生成如下各个关键词对应的code block。（在你还没有定义对应的steps.rb才会生成，参见<code>cuke_oc/features/step_definitions/check_kai_steps.rb</code>。文件命名关系不大，但是一般以steps结尾。）</p>

<p><img src="http://i.imgur.com/JqweeIf.jpg" alt="" /></p>

<p>复制粘帖以上<code>小黄瓜</code>的输出至<code>cuke_oc/features/step_definitions/foo_steps.rb</code>然后就可以开始填写代码了。当case运行时，会按序运行各个code block中的代码。使用除了英文以外的语言时，别忘记在文件顶端加上<code># encoding: utf-8</code></p>

<h1>代码详解</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Given</span> <span class="sr">/^我根据 (.*) 文件中的配置建立运费信息$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">mprpc_data_file</span><span class="o">|</span>
</span><span class='line'>  <span class="vi">@fid</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="vi">@mprpc_res</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>  <span class="c1"># 从mprpc_data_file文件中读取这个case所需要的运费模板参数</span>
</span><span class='line'>  <span class="vi">@mprpc_params</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;./data/wgoc_cases/&#39;</span> <span class="o">+</span> <span class="n">mprpc_data_file</span><span class="p">))</span>
</span><span class='line'>  <span class="c1"># 向桩发送请求，生成运费模板</span>
</span><span class='line'>  <span class="vi">@mprpc_res</span> <span class="o">=</span> <span class="no">RestClient</span><span class="o">.</span><span class="n">post</span> <span class="no">JSONRPC_SEND_POSTAGEAPI_ADDTEMPLATE_URI</span><span class="p">,</span> <span class="vi">@mprpc_params</span><span class="o">.</span><span class="n">to_json</span> <span class="k">unless</span> <span class="vi">@mprpc_params</span><span class="o">.</span><span class="n">empty?</span>
</span><span class='line'>  <span class="c1"># 从返回中获得运费模板的id</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">!</span><span class="vi">@mprpc_res</span><span class="o">.</span><span class="n">nil?</span> <span class="o">&amp;&amp;</span> <span class="vi">@mprpc_res</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">200</span>
</span><span class='line'>    <span class="vi">@fid</span> <span class="o">=</span> <span class="p">(</span><span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="vi">@mprpc_res</span><span class="o">.</span><span class="n">body</span><span class="p">))</span><span class="o">[</span><span class="s1">&#39;result&#39;</span><span class="o">][</span><span class="s1">&#39;result&#39;</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>向桩发送请求，并根据<code>mprpc_data_file</code>中的参数，生成运费模板。现在<code>mprpc_data_file</code>用的是yaml格式。使用了<a href="https://github.com/rest-client/rest-client">RestClient</a>这个<code>gem</code>来发送各种<code>http</code>请求。（什么是<a href="http://guides.rubygems.org/">gem</a>?）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Given</span> <span class="sr">/^我根据 (.*) 文件中的配置制造mock商品信息$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">mock_data_file</span><span class="o">|</span>
</span><span class='line'>  <span class="c1"># 从mock_data_file读取mock商品的参数</span>
</span><span class='line'>  <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;./data/wgoc_cases/&#39;</span> <span class="o">+</span> <span class="n">mock_data_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
</span><span class='line'>      <span class="vi">@mock_params</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="c1"># 把前面mprpc返回的delivery_id设定为mock商品的fid</span>
</span><span class='line'>  <span class="vi">@mock_params</span><span class="o">[</span><span class="s1">&#39;queryInfo&#39;</span><span class="o">][</span><span class="s1">&#39;fid&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@fid</span> <span class="k">unless</span> <span class="vi">@fid</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>  <span class="c1"># 向桩发送请求，生成mock商品的kv和queryInfo信息</span>
</span><span class='line'>  <span class="no">RestClient</span><span class="o">.</span><span class="n">get</span> <span class="no">SCAFFOLDING_CREATE_KV_URI</span><span class="p">,</span> <span class="ss">:params</span> <span class="o">=&gt;</span> <span class="vi">@mock_params</span><span class="o">[</span><span class="s1">&#39;kv&#39;</span><span class="o">]</span> <span class="k">unless</span> <span class="o">!</span><span class="vi">@mock_params</span><span class="o">.</span><span class="n">key?</span><span class="p">(</span><span class="s1">&#39;kv&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="vi">@mock_params</span><span class="o">[</span><span class="s1">&#39;kv&#39;</span><span class="o">].</span><span class="n">nil?</span>
</span><span class='line'>  <span class="no">RestClient</span><span class="o">.</span><span class="n">get</span> <span class="no">SCAFFOLDING_CREATE_PRODUCTAPI_QUERYINFO_URI</span><span class="p">,</span> <span class="ss">:params</span> <span class="o">=&gt;</span> <span class="vi">@mock_params</span><span class="o">[</span><span class="s1">&#39;queryInfo&#39;</span><span class="o">]</span> <span class="k">unless</span> <span class="o">!</span><span class="vi">@mock_params</span><span class="o">.</span><span class="n">key?</span><span class="p">(</span><span class="s1">&#39;queryInfo&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="vi">@mock_params</span><span class="o">[</span><span class="s1">&#39;queryInfo&#39;</span><span class="o">].</span><span class="n">nil?</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>向商品库的桩发送请求，并根据<code>mock_data_file</code>中的参数，制造mock商品。现在<code>mock_data_file</code>用的是yaml格式。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Given</span> <span class="sr">/^我从 (.*) 文件中读取某http请求$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">request_data_file</span><span class="o">|</span>
</span><span class='line'>  <span class="c1"># 从request_data_file中读取验单所需的参数信息</span>
</span><span class='line'>  <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;./data/wgoc_cases/&#39;</span> <span class="o">+</span> <span class="n">request_data_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
</span><span class='line'>      <span class="vi">@request_params</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>读取<code>request_data_file</code>文件中定义的请求信息。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">When</span> <span class="sr">/^我用post方法发送该请求至oc的话$/</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># 向oc发送验单请求</span>
</span><span class='line'>  <span class="vi">@last_response</span> <span class="o">=</span> <span class="no">RestClient</span><span class="o">.</span><span class="n">get</span> <span class="no">CHECK_REQUEST_URI</span><span class="p">,</span> <span class="ss">:params</span> <span class="o">=&gt;</span> <span class="vi">@request_params</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>根据刚刚读取的请求信息，给oc发送验单请求。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Then</span> <span class="sr">/^我将得到与 (.*) 文件中相同的json串$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">response_data_file</span><span class="o">|</span>
</span><span class='line'>  <span class="c1"># 使用了Rspec提供的should的断言方法</span>
</span><span class='line'>  <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="vi">@last_response</span><span class="o">.</span><span class="n">body</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;./data/wgoc_cases/&#39;</span> <span class="o">+</span> <span class="n">response_data_file</span><span class="p">))</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>跟<code>response_data_file</code>中定义的预期的json串作比较。不相同的话就触发断言。</p>

<h1>总结</h1>

<p>有问题可发送邮件至<code>lengyu@baidu.com</code>。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何使用Capybara和Cucumber实现页面级别自动化]]></title>
    <link href="http://Fatman13.github.io/blog/2014/01/26/ru-he-shi-yong-capybarahe-cucumbershi-xian-ye-mian-ji-bie-zi-dong-hua/"/>
    <updated>2014-01-26T21:37:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2014/01/26/ru-he-shi-yong-capybarahe-cucumbershi-xian-ye-mian-ji-bie-zi-dong-hua</id>
    <content type="html"><![CDATA[<p>本文将简单介绍如何使用capybara/cucumber来实现页面级别的自动化。并将结合微购的订单流程做一个讲解。在这儿为大家强烈推讲下<a href="http://pragprog.com/book/hwcuc/the-cucumber-book">The Cucumber Book</a>以及<a href="http://pragprog.com/book/dhwcr/cucumber-recipes">Cucumber Recipes</a>这2本书。几乎包含了关于<code>小黄瓜</code>的一切。<a href="http://product.dangdang.com/23280484.html#ddclick?act=click&amp;pos=23280484_16_1_p&amp;cat=01.00.00.00.00.00&amp;key=Cucumber&amp;qinfo=&amp;pinfo=20_1_72&amp;minfo=&amp;ninfo=&amp;custid=&amp;permid=20140126101508135714985587192225073&amp;ref=http%3A%2F%2Fbook.dangdang.com%2F&amp;rcount=&amp;type=&amp;t=1390702656000">当当网</a>上也有购买，有兴趣的同学可以问我借阅。以下将这2本书简称为<code>小黄瓜全书</code>和<code>小黄瓜食谱</code>。</p>

<!--more-->


<h1>Capybara简介</h1>

<p>Capybara封装了众多帮助页面自动化的函数。极大的简化了开发流程。Capybara的API可参看<code>小黄瓜全书</code>中<code>15.3 The Capybara API</code>章节。</p>

<h1>Cucumber简介</h1>

<p>小黄瓜是一个强大的自动化测试框架。完善的文档，Gherkin式的测试文档，全局/Case级别的setup/teardown，配合Ruby庞大的gem库，支持各种格式report的生成，等等。</p>

<h1>软件安装</h1>

<p>请参看<code>小黄瓜全书</code>里面的Appendix 2: Installing cucumber的章节。以工作机为例，安装以下即可。<br/>
&ndash; <a href="http://railsinstaller.org/">RailsInstaller</a>（RailsInstaller包含了Ruby1.9.3，Bundler，Git等等众多Ruby开发工具。）<br/>
&ndash; <a href="https://github.com/adoxa/ansicon/downloads">ANSICON</a></p>

<h1>运行自动化</h1>

<p>下载代码，解压，打开命令行，切换到解压后的文件夹中，运行<code>bundle install</code>，修改<code>cuke_pc/features/step_definitions/cod_steps.rb</code>，把以下登录信息改为你自己的百度账号和密码。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">fill_in</span> <span class="s1">&#39;userName&#39;</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="s1">&#39;在此输入你的百度账号&#39;</span>
</span><span class='line'><span class="n">fill_in</span> <span class="s1">&#39;TANGRAM__PSP_4__password&#39;</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="s1">&#39;在此输入你的百度帐号密码&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>运行<code>cucumber features/wgpc_cod.feature</code>，自动化就跑起来了！</p>

<h1>代码讲解</h1>

<p>在这个<code>cucumber features/wgpc_cod.feature</code>自动化Case中，<br/>
代码都在<code>cuke_pc/features/step_definitions/cod_steps.rb</code>里面。为大家详解一下<code>cod_steps.rb</code>中的代码。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Given</span> <span class="sr">/^我已登录用户中心$/</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># 访问个人中心页面</span>
</span><span class='line'>  <span class="n">visit</span> <span class="s1">&#39;http://zhixin.baidu.com/Login/index?module=onesite&amp;u=http%3A%2F%2Fcp01-testing-cbbs06.cp01.baidu.com%3A8888%2Fitem%3Fid%3D181835090&amp;from=&#39;</span>
</span><span class='line'>  <span class="c1"># 在登录页面中，输入自己的百度账号</span>
</span><span class='line'>  <span class="n">fill_in</span> <span class="s1">&#39;userName&#39;</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="s1">&#39;在此输入你的百度账号&#39;</span>
</span><span class='line'>  <span class="c1"># 输入自己百度账号密码</span>
</span><span class='line'>  <span class="n">fill_in</span> <span class="s1">&#39;TANGRAM__PSP_4__password&#39;</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="s1">&#39;在此输入你的百度帐号密码&#39;</span>
</span><span class='line'>  <span class="c1"># 点击登录</span>
</span><span class='line'>  <span class="n">click_button</span> <span class="s1">&#39;TANGRAM__PSP_4__submit&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>visit</code>函数: 根据配置，自动打开网页浏览器，并访问参数中指定的url。<br/>
<code>fill_in</code>函数: 根据id,name或者label text找到输入框，并填写参数所指定的String。<br/>
<code>click_button</code>函数: 根据id,name或者label text找到按钮，并点击该按钮。<br/>
以上代码实现的是，首先打开火狐，进入个人中心页面，输入用户名密码，并点击登录。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Given</span> <span class="sr">/^我在中间页对&quot;(.*?)&quot;商品下单:一$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="o">|</span>
</span><span class='line'>  <span class="c1"># 这个暂时不关注</span>
</span><span class='line'>  <span class="vi">@expected_time_range</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="o">.</span><span class="n">.</span> <span class="p">(</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="o">+</span> <span class="mi">600</span><span class="p">)</span>
</span><span class='line'>  <span class="c1"># 点击立即购买</span>
</span><span class='line'>  <span class="n">find</span><span class="p">(</span><span class="s1">&#39;#detail-buy&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
</span><span class='line'>  <span class="c1"># 浏览器窗口最大化</span>
</span><span class='line'>  <span class="n">page</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">manage</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">maximize</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>find</code>函数: 根据CSS Selector或者Xpath找到对应的元素。以便于更进一步的操作。<br/>
以上代码实现的是，在中间页，点击<code>立刻购买</code>。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">When</span> <span class="sr">/^我选取货到付款$/</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># 根据lablel元素上的字，找到“货到付款”并点击</span>
</span><span class='line'>  <span class="n">find</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="sr">/\A货到付款\z/</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
</span><span class='line'>  <span class="c1"># 等待“提交订单”的出现</span>
</span><span class='line'>  <span class="n">find</span><span class="p">(</span><span class="s1">&#39;.order-summary-submit&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="c1"># 点击“提交订单”</span>
</span><span class='line'>  <span class="n">find</span><span class="p">(</span><span class="s1">&#39;.order-summary-submit&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
</span><span class='line'>  <span class="c1"># 通过xpath，找到查看所有订单按钮，并点击</span>
</span><span class='line'>  <span class="n">find</span><span class="p">(</span><span class="ss">:xpath</span><span class="p">,</span> <span class="s2">&quot;//a[@href=&#39;/service/user/order/list&#39;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>以上代码实现的是，在验单页面，点击<code>货到付款</code>，点击<code>提交订单</code>，点击<code>查看订单</code>。注意，如果提交订单失败的话，这个case就会在这儿挂掉。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Then</span> <span class="sr">/^个人中心订单状态被告更改为&quot;(.*?)&quot;$/</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="o">|</span>
</span><span class='line'>  <span class="c1"># 这个暂时不关注</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">find</span><span class="p">(</span><span class="ss">:xpath</span><span class="p">,</span> <span class="s2">&quot;(//td[@class=&#39;time&#39;])[1]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span><span class='line'>  <span class="vi">@order_time</span> <span class="o">=</span> <span class="no">DateTime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">find</span><span class="p">(</span><span class="ss">:xpath</span><span class="p">,</span> <span class="s2">&quot;(//td[@class=&#39;time&#39;])[1]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-%d %H:%M:%S&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="vi">@expected_time_range</span><span class="o">.</span><span class="n">cover?</span><span class="p">(</span><span class="vi">@order_time</span><span class="p">)</span>
</span><span class='line'>  <span class="c1"># 使用xpath，找到之前下的订单，并比较订单状态是否是“等待发货”</span>
</span><span class='line'>  <span class="n">find</span><span class="p">(</span><span class="ss">:xpath</span><span class="p">,</span> <span class="s2">&quot;(//span[@class=&#39; status_confirm&#39;])[1]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>should</code>函数: RSpec里面的一个断言的方法。<br/>
<code>have_content</code>函数: 判定元素中是否存在参数中的字段。<br/>
以上代码实现的是，回到个人中心后，比较最近的一个订单是不是处于<code>等待发货</code>状态，如果状态错误Case就会挂掉。</p>

<h1>总结</h1>

<p><code>Capybara/Cucumner</code>是一个有完善文档的，非常强大的测试框架。希望以后能用于主流程的保证。不知道医疗那边的同学需不需要？无论是测死链，或者是ajax也都完全没有问题。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How-to: Setup your personal VPN with Amazon EC2 for FREE]]></title>
    <link href="http://Fatman13.github.io/blog/2013/12/29/how-to-setup-your-personal-vpn-with-amazon-ec2-for-free/"/>
    <updated>2013-12-29T11:20:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2013/12/29/how-to-setup-your-personal-vpn-with-amazon-ec2-for-free</id>
    <content type="html"><![CDATA[<p>This tutorial will walk you through setting up a personal <a href="http://en.wikipedia.org/wiki/Point-to-Point_Tunneling_Protocol">PPTP</a> VPN server and connecting to it from a Windows Client. Using a VPN have merits like browsing the internet in relative privacy. Also new signups can use Amazon EC2 micro instance without paying for the first year.</p>

<!--more-->


<h1>Step 1: Get Set Up</h1>

<p>Follow the official <code>get set up</code> guide for Amazon EC2 <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/get-set-up-for-amazon-ec2.html">here</a>. The intructions are more comprehensive, in my opinoin, than blog posts from Google search results.</p>

<h1>Step 2: Create EC2 Instance</h1>

<p>Follow <code>step 1: Launch an Instance</code> and <code>step 2: Connect to your Instance</code> of the offical <code>get started</code> guide for Amazon EC2 <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EC2_GetStarted.html">here</a>.<br/>
<strong>Note1:</strong> Instead of <strong>Select an Amazon Machine Image(AMI)</strong>, choose a <code>ubuntu 12.04 server</code> image.<br/>
<strong>Note2:</strong> The dafault accout for AMI images is <code>ec2-user</code>, however, for ubuntu images you have to use <code>ubuntu</code> to connect to your instance.<br/>
<strong>Note3:</strong> In the <code>AWS Management Console</code>, choose a regoin that is geograpgically closest to your location to have best browsing experience. I have chosen Singapore as shown below.</p>

<p><img src="http://Fatman13.github.io/images/ec2_region.jpg" width="233" height="317" title="1" ></p>

<p><strong>Note4:</strong> Below is the my security group settings for your reference.</p>

<p><img src="http://Fatman13.github.io/images/ec2_sg.jpg" width="613" height="253" title="1" ></p>

<h1>Step 3: Configure EC2 Instance</h1>

<p>Follow the guide on the offical Ubuntu documentation <a href="https://help.ubuntu.com/community/PPTPServer">here</a> to configure your ec2 instance into a PPTP server. Remember to right-click on your running instance in <code>AWS Management Console</code> and reboot your ec2 instance after you are done.</p>

<h1>Step 4.1: Connecting from a Windows 7 Client</h1>

<p>Open your Google Chrome, type in <code>chrome://settings/search#proxy</code>, hit <code>enter</code> and then click on <code>Change proxy settings</code> button. Click <code>new VPN(p)</code>. Enter either your ec2 instance public name or ip address as <code>internet address</code> and check the 3rd checkbox like shown below.</p>

<p><img src="http://Fatman13.github.io/images/ec2_conn.jpg" width="635" height="504" title="1" ></p>

<p>Click <code>next</code>, enter your VPN account name and password you have just setup in setp 3, click <code>next</code> and finally click <code>finish</code>. Now you should be able to see your VPN connection once you click the network icon in the notification area on your windows task bar. Right click on your VPN connection, go to <code>properties</code>, under <code>security tab</code>, configure everything the same as the screenshot below.</p>

<p><img src="http://Fatman13.github.io/images/vpn_conf.jpg" width="378" height="456" title="1" ></p>

<p>Now go ahead connect to your VPN, type in your account and password. Wait till the status turns into <code>Connected</code>.</p>

<p><img src="http://Fatman13.github.io/images/vpn_conn.jpg" width="278" height="393" title="1" ></p>

<p>Congratulations! You now have your own personal VPN.</p>

<h1>Welcome to the Internet!</h1>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[乐高园游记]]></title>
    <link href="http://Fatman13.github.io/blog/2013/11/24/le-gao-yuan-you-ji/"/>
    <updated>2013-11-24T12:58:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2013/11/24/le-gao-yuan-you-ji</id>
    <content type="html"><![CDATA[<p>这次去了一趟传说中的LEGO LAND&copy;。记一篇游记。</p>

<!--more-->


<h1>题外话</h1>

<p><img src="http://Fatman13.github.io/images/Screenshot_gmap_sausalito.png" width="848" height="371" title="1" ></p>

<p>这个是<code>谷歌地图</code>，如果你拖拽街景小人，并放到地图上的话，是这个样子的。</p>

<p><img src="http://Fatman13.github.io/images/Screenshot_gmap_legoland.png" width="852" height="366" title="1" ></p>

<p>如果你拖拽街景小人至乐高园区内的话，街景的火柴人就会变成一乐高小人。挺有爱的。</p>

<h1>行程</h1>

<ul>
<li>11月12号驱车去<code>乐高宾馆</code>住一晚。</li>
<li>11月13号在园区内逛一天。</li>
</ul>


<h1>宾馆</h1>

<p><img src="http://Fatman13.github.io/images/WP_20131112_002.resized.jpg" width="700" height="394" title="1" ></p>

<p>开车开了好久，终于到<code>乐高宾馆</code>啦。</p>

<p><img src="http://Fatman13.github.io/images/WP_20131112_006.resized.jpg" width="700" height="394" title="1" ></p>

<p>总体感觉，没有他们广告里面的照片高级。。。房间是乐高城堡主题。还有海盗和另外一个什么主题的客房。</p>

<p><img src="http://Fatman13.github.io/images/WP_20131112_007.resized.jpg" width="700" height="394" title="1" ></p>

<p>这边有专门给小孩子睡的双层小床。</p>

<h1>游乐园</h1>

<p>正当我要准备进入乐高园时，令人难以置信的一幕发生了！！！！！！</p>

<p>我被告知乐高园每周2，3是不开门的。</p>

<h1>终&hellip;&hellip;</h1>

<p><img src="http://Fatman13.github.io/images/Screenshot_rage_c.png" width="350" height="284" title="1" ></p>

<h1>附录</h1>

<p>U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U</p>

<blockquote><p>We believe what we want to believe. It is all we ever do.<br/>
&mdash; <cite>Flemeth《<a href="http://en.wikipedia.org/wiki/Dragon_Age:_Origins">Dragon Age: Origin</a>》</cite></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[noisehush freedom BT700蓝牙耳机评测]]></title>
    <link href="http://Fatman13.github.io/blog/2013/11/13/noisehush-freedom-bt700lan-ya-er-ji-ping-ce/"/>
    <updated>2013-11-13T13:08:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2013/11/13/noisehush-freedom-bt700lan-ya-er-ji-ping-ce</id>
    <content type="html"><![CDATA[<p>最近买了一个<a href="http://www.amazon.com/NoiseHush-BT700-12266-Freedom-Bluetooth-Headphones/dp/B00EP7B800/ref=sr_1_2?ie=UTF8&amp;qid=1384377703&amp;sr=8-2&amp;keywords=noisehush+bt700">新耳机</a>。感觉还不错，写一个评测。</p>

<!--more-->


<h1>外观&amp;功能</h1>

<p><img src="http://Fatman13.github.io/images/IMAG0848.resized.jpg" width="600" height="339" title="1" ></p>

<p>盒子不错，简单大方。很硬。</p>

<p><img src="http://Fatman13.github.io/images/IMAG0852.resized.jpg" width="600" height="339" title="1" ></p>

<p>左耳，以及左耳上的功能键。</p>

<p><img src="http://Fatman13.github.io/images/IMAG0853.resized.jpg" width="600" height="339" title="1" ></p>

<p>最上：上一首；下一首；播放；暂停；音量+-<br/>
中间：usb mini接口（<em>充电用</em>）<br/>
最下：电源开关（<em>开机&mdash;&ndash;>长按3秒；关机&mdash;&ndash;>长按3秒；蓝牙搜索&mdash;&mdash;&ndash;>长按5秒</em>)</p>

<p><img src="http://Fatman13.github.io/images/IMAG0855.resized.jpg" width="600" height="339" title="1" ></p>

<p>右耳。</p>

<p><img src="http://Fatman13.github.io/images/IMAG0856.resized.jpg" width="600" height="339" title="1" ></p>

<p>耳朵内侧。</p>

<h1>兼容性</h1>

<p>经测试，以下设备都成功链接上了这个耳机。<br/>
* HTC Sensation<br/>
* Nokia Lumia 820<br/>
* System76 Gazelle-pro （Ubuntu 13.04）</p>

<h1>总体评价</h1>

<p>用下来感觉还是很不错的。第一次用蓝牙耳机，那种没有被一般耳机的那一根线牵着的感觉很好。当然本人不是对声音很敏感的人，所以也听不出好耳机跟坏耳机的区别。声音感觉过得去就行了。这个耳机戴在耳朵上的感觉也不会太紧。感觉开机后左耳的那个灯，晚上的话，会特别闪，可能要贴一张胶布遮住。由于2个耳朵是圆形的设计，所以并不能完全覆盖整个耳朵，所以隔音效果可能没有长方形的耳机好。再来就是有<a href="https://www.youtube.com/watch?v=QK8mJJJvaes">某一些视频</a>会有声音慢半拍的现象，但是经测试大多数情况还是正常的，比如说<a href="http://www.bilibili.tv/">b站</a>什么的。</p>

<h1>附录</h1>

<p>U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U</p>

<iframe width="640" height="360" src="http://Fatman13.github.io//www.youtube.com/embed/XeFxdkaFzRA" frameborder="0" allowfullscreen></iframe>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Google Analytics统计的本博客的流量]]></title>
    <link href="http://Fatman13.github.io/blog/2013/10/16/google-analyticstong-ji-de-ben-bo-ke-de-liu-liang/"/>
    <updated>2013-10-16T16:20:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2013/10/16/google-analyticstong-ji-de-ben-bo-ke-de-liu-liang</id>
    <content type="html"><![CDATA[<p>发表一下使用<a href="http://www.google.com/analytics/">Google Analytics</a>统计的本博客的流量。</p>

<!--more-->


<p><img src="http://Fatman13.github.io/images/ga_1.resized.JPG" width="951" height="223" title="1" ></p>

<p>55个访客！你们好！</p>

<p><img src="http://Fatman13.github.io/images/ga_2.resized.jpg" width="672" height="415" title="1" ></p>

<p>世界你好！最近习总是不是刚去过坦桑尼亚？之前我记得有2个伊朗的访客呀，被谷歌掐掉了吗？！</p>

<p><img src="http://Fatman13.github.io/images/ga_3.resized.JPG" width="867" height="410" title="1" ></p>

<p>根据国家划分访客。</p>

<p><img src="http://Fatman13.github.io/images/ga_4.resized.JPG" width="848" height="307" title="1" ></p>

<p>根据网页浏览器划分访客。发现Opera&hellip;.</p>

<p><img src="http://Fatman13.github.io/images/ga_6.resized.JPG" width="851" height="245" title="1" ></p>

<p>移动端访客使用的都是苹果&hellip;</p>

<p><img src="http://Fatman13.github.io/images/ga_7.resized.JPG"></p>

<p>根据网络供应商划分访客。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GeoGuessr新手心得]]></title>
    <link href="http://Fatman13.github.io/blog/2013/09/26/geoguessrxin-shou-xin-de/"/>
    <updated>2013-09-26T10:52:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2013/09/26/geoguessrxin-shou-xin-de</id>
    <content type="html"><![CDATA[<p>经同事介绍一个叫<a href="http://geoguessr.com/">GeoGuessr</a>的网页小游戏。玩一下还可以。记录一下心得。</p>

<!--more-->


<h1>游戏流程</h1>

<p>游戏随机把你放到世界某个地方的谷歌街景。然后你可以根据周围的风景，猜你在哪儿。结果离正确答案越近，分数越高。猜完5次以后，结束一个周目。你获得的总分会被显示出来。</p>

<h1>心得</h1>

<ul>
<li><p>很多国家还没有谷歌街景，所以一般可以排除非洲大多数国家，南美(除巴西)，中国(除香港)，很多南亚国家，印度，很多中东国家，等等。</p></li>
<li><p>欧洲很多马路中间分界线是白色的。一般大多数其他国家都是黄色的。</p></li>
<li><p>土壤是红色的话，这个地方比较热。可以参考猜澳洲，中美洲，巴西。</p></li>
<li><p>关于高速公路。</p>

<ul>
<li>看周围的植物。是比较热带的感觉还是比较寒冷的感觉。</li>
<li>看周围是否是大山环绕，还是开阔的平原。</li>
<li>看高速路上的标志，是用英制单位还是国际单位。英制单位的话很有可能就是美国了。</li>
<li>看路上车子的款式。</li>
</ul>
</li>
<li><p>俄罗斯的交通标志跟国内很像。特别是<code>此处有人行道</code>的交通标志。</p></li>
<li><p>街景中看见地名的标志，路牌等等，当然可以直接谷歌下，但是有舞弊的嫌疑&hellip;</p></li>
</ul>


<h1>截图</h1>

<p><img src="http://Fatman13.github.io/images/g10.JPG" width="665" height="500" title="最高记录" ></p>

<p>随手一猜，竟然只差100公里。啧啧。</p>

<p><img src="http://Fatman13.github.io/images/g20.JPG" width="852" height="600" title="一周目" ></p>

<p>一周目结束。</p>

<h1>附录</h1>

<p>U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U</p>

<iframe width="480" height="360" src="http://Fatman13.github.io//www.youtube.com/embed/8EmRZO9fwvk" frameborder="0" allowfullscreen></iframe>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How-to: Host rails app on OpenShift for FREE]]></title>
    <link href="http://Fatman13.github.io/blog/2013/09/16/how-to-host-rails-app-on-openshift-for-free/"/>
    <updated>2013-09-16T14:39:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2013/09/16/how-to-host-rails-app-on-openshift-for-free</id>
    <content type="html"><![CDATA[<p>There are many great options for hosting your rails application. For instances, <a href="http://en.wikipedia.org/wiki/Platform_as_a_service">PaaS</a> like <a href="https://www.engineyard.com/">engine yard</a> and <a href="https://www.heroku.com/">heroku</a> provide great scalability and automations to ease your deployment. VPS like <a href="https://www.linode.com/">Linode</a> provides more traditional hosting services, which gives you full control of a node. But what if you just want to test your idea and have a public domain name (no tunneling and router tricks)? Then OpenShift is a great choice, cause it is FREE! (at least for your first 3 gears)</p>

<!--more-->


<h1>Good Resources</h1>

<ul>
<li><p>Official rails quick starter <a href="https://www.openshift.com/kb/kb-e1005-ruby-on-rails-openshift-quickstart-guide">guide</a>.</p></li>
<li><p>Official sample rails app on <a href="https://github.com/openshift-quickstart/rails-sunspot-openshift-quickstart">github</a>.</p></li>
<li><p>Official documentation on deployment <a href="http://openshift.github.io/documentation/oo_cartridge_developers_guide.html#openshift-builds">scripts</a>.</p></li>
<li><p>Deployment tutorial <a href="http://ror-tech.blogspot.com/2013/04/deploying-rails-application-on-to.html">guide</a>.</p></li>
</ul>


<h1>Deployment</h1>

<p><em>This guide will be similar to steps described in the resouces mentioned above. I will add my thoughts to some of the steps.</em></p>

<p><strong>1</strong>. Create an <a href="http://www.openshift.com">OpenShift</a> account.</p>

<p><strong>2</strong>.  Install <code>rhc</code> gem. (If you are using <code>rvm</code>, don’t use <code>sudo</code>.)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install rhc</span></code></pre></td></tr></table></div></figure>


<p></p>

<p><strong>3</strong>. Create your cartridge. This should create a folder called <code>[your_rails_app_name]</code> at <code>.</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rhc app create -a [your_rails_app_name] -t ruby-1.9</span></code></pre></td></tr></table></div></figure>


<p><strong>4</strong>. Add database support to your application.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rhc cartridge add -a [your_rails_app_name] -c [database_name]</span></code></pre></td></tr></table></div></figure>


<p>Here is a list of supported database.</p>

<table>
<thead>
<tr>
<th align="left">Short Name </th>
<th align="left"> Full name</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">10gen-mms-agent-0.1 </td>
<td align="left"> 10gen Mongo Monitoring Service Agent</td>
</tr>
<tr>
<td align="left">cron-1.4 </td>
<td align="left"> Cron 1.4</td>
</tr>
<tr>
<td align="left">jenkins-client-1 </td>
<td align="left"> Jenkins Client</td>
</tr>
<tr>
<td align="left">mongodb-2.2 </td>
<td align="left"> MongoDB NoSQL Database 2.2</td>
</tr>
<tr>
<td align="left">mysql-5.1 </td>
<td align="left"> MySQL Database 5.1</td>
</tr>
<tr>
<td align="left">metrics-0.1 </td>
<td align="left"> OpenShift Metrics 0.1</td>
</tr>
<tr>
<td align="left">haproxy-1.4 </td>
<td align="left"> OpenShift Web Balancer</td>
</tr>
<tr>
<td align="left">phpmyadmin-3 </td>
<td align="left"> phpMyAdmin 3.4</td>
</tr>
<tr>
<td align="left">postgresql-8.4 </td>
<td align="left"> PostgreSQL Database 8.4</td>
</tr>
<tr>
<td align="left">postgresql-9.2 </td>
<td align="left"> PostgreSQL Database 9.2</td>
</tr>
<tr>
<td align="left">rockmongo-1.1 </td>
<td align="left"> RockMongo 1.1</td>
</tr>
<tr>
<td align="left">switchyard-0 </td>
<td align="left"> SwitchYard 0.8.0</td>
</tr>
</tbody>
</table>


<p><strong>5</strong>. Add <code>deploy</code> script to <code>[your_rails_app_name]/.openshift/action_hooks/</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>touch [your_rails_app_name]/.openshift/action_hooks/deploy</span></code></pre></td></tr></table></div></figure>


<p>Add the following code to <code>deploy</code> file to initialize database.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">pushd</span> <span class="err">$</span><span class="p">{</span><span class="no">OPENSHIFT_REPO_DIR</span><span class="p">}</span> <span class="o">&gt;</span> <span class="sr">/dev/nu</span><span class="n">ll</span>
</span><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">migrate</span> <span class="no">RAILS_ENV</span><span class="o">=</span><span class="s2">&quot;production&quot;</span>
</span><span class='line'><span class="n">popd</span> <span class="o">&gt;</span> <span class="sr">/dev/nu</span><span class="n">ll</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>NOTE: This might be obvious to experienced Linux user, but I failed to realize this the first time. You have to do a <code>sudo chmod +x [your_rails_app_name]/.openshift/action_hooks/deploy</code> on your <code>deploy</code> script or it won’t be run by the server.</em></p>

<p><strong>6</strong>. Change production database configuration in <code>config/database.yml</code>. Then submit your change to your <a href="https://github.com/">github</a> repository.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">production</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">adapter</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">mysql2</span>
</span><span class='line'>  <span class="l-Scalar-Plain">encoding</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">utf8</span>
</span><span class='line'>  <span class="l-Scalar-Plain">reconnect</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class='line'>  <span class="l-Scalar-Plain">pool</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">5</span>
</span><span class='line'>  <span class="l-Scalar-Plain">database</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%=ENV[&#39;OPENSHIFT_APP_NAME&#39;]%&gt;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">username</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%=ENV[&#39;OPENSHIFT_MYSQL_DB_USERNAME&#39;]%&gt;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%=ENV[&#39;OPENSHIFT_MYSQL_DB_PASSWORD&#39;]%&gt;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">socket</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%=ENV[&#39;OPENSHIFT_MYSQL_DB_SOCKET&#39;]%&gt;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">host</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%=ENV[&#39;OPENSHIFT_MYSQL_DB_HOST&#39;]%&gt;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%=ENV[&#39;OPENSHIFT_MYSQL_DB_PORT&#39;]%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>NOTE: Remember to change adapter and ENV variable to corresponding database your are using. For example, If your are using postgresql then change <code>&lt;%=ENV['OPENSHIFT_MYSQL_DB_USERNAME']%&gt;</code> to <code>&lt;%=ENV['OPENSHIFT_POSTGRESQL_DB_USERNAME']%&gt;</code></em></p>

<p><strong>7</strong>. Download your rails application from your github repository.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">cd railsapp</span>
</span><span class='line'><span class="l-Scalar-Plain">git remote add upstream -m master [your_git_repo_ssh_url]</span>
</span><span class='line'><span class="l-Scalar-Plain">git pull -s recursive -X theirs upstream master</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>8</strong>. Do <code>git push</code>. <code>git push</code> will initialize the server and trigger the <code>deploy</code> script. If everything goes alright, you should see your application running on <code>http://[your_rails_app_name]-[your_namespace].rhcloud.com</code>. You can customize your domain name too. Check this <a href="http://ror-tech.blogspot.com/2013/04/deploying-rails-application-on-to.html">post</a> out to learn details.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Eador: Masters of the broken worlds 新手心得]]></title>
    <link href="http://Fatman13.github.io/blog/2013/09/08/eador-masters-of-the-broken-worlds-xin-shou-xin-de/"/>
    <updated>2013-09-08T13:55:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2013/09/08/eador-masters-of-the-broken-worlds-xin-shou-xin-de</id>
    <content type="html"><![CDATA[<p><code>Eador: Masters of the broken worlds</code>是最近少有的奇幻系<a href="http://en.wikipedia.org/wiki/Turn-based_strategy">TBS</a>类型的游戏。玩了几盘，还不错。写下心得体会。</p>

<!--more-->


<p><em>注：本人玩的都是</em><code>beginner</code><em>难度，高阶难度是否适用不得而知&hellip;&hellip;</em></p>

<h1>游戏简介</h1>

<p>这里使用SplatterCat制作的游戏流程影像。</p>

<iframe width="853" height="480" src="http://Fatman13.github.io//www.youtube.com/embed/q4ARvRq8z34?list=PLWIol4T7LuShSOr8zmTvtVbAS0Z-0WxmO" frameborder="0" allowfullscreen></iframe>


<h1>英雄</h1>

<ul>
<li><p>个人比较喜欢<a href="http://eador-masters-of-the-broken-world.wikia.com/wiki/Wizard">法师</a>。英雄升级技能主<code>Necromancy</code>和<code>Magic Power</code>比较实用。特别是<code>Necromancy</code>能使召唤出来的不死族加入到英雄的军队中。初期非常实用。</p></li>
<li><p>法师中后期没有高阶法术的支持，不太好打。但是如果运气好在explore的时候打到好的spell的话，会很强。有一次我在explore province的时候，捡到了<a href="http://eador-masters-of-the-broken-world.wikia.com/wiki/Elemental_Magic">Incinerate</a>，能对对方单体造成40点伤害。初期几乎见谁秒谁。</p></li>
</ul>


<h1>省（Province）</h1>

<ul>
<li><p>一般离主城越近的province敌人的守卫越弱。离主城越远，敌人守卫等级越高，数量也越多。</p></li>
<li><p>省份攻略难度大致为：Free Settlement &lt; Golbin Land, Orcish Tribe &lt; Outlaw Brigand &lt; Lizard Land &lt; Dwarf, Halfing（这儿开始没有T2的兵就很难打了&hellip;）&lt; Nomad &lt; Elven &lt; Centaur  &lt; Giant Spider</p></li>
</ul>


<h1>经济</h1>

<ul>
<li>经济发展主要还是要靠打仗收入，和占领省市。一直捂在家里很难发展起来。初期法师英雄建议早造Shaman帮助英雄打掉主城周围一圈的省份。</li>
</ul>


<h1>作弊大法</h1>

<ul>
<li>由于战役做的实在太冗长&hellip;每次去打新地图的时候，主城，英雄都要从头开始。于是我不能忍了。就作弊了。在<code>Documents/Eador/profiles/player0/saves</code>路径下找到存档文件。用文字编辑器打开存档文件。按<code>ctrl + f</code>寻找<code>gold=</code>找到之后就能修改这个存档的金钱了。要注意的是修改不能改位子位数。例如<code>gold=100</code>那就只能改成<code>gold=999</code>，如果改成<code>gold=99999</code>就会污染存档，导致无法读取&hellip;</li>
</ul>


<h1>附录</h1>

<p>U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
U<br/>
大牛教你如何把肉打松。</p>

<iframe width="853" height="480" src="http://Fatman13.github.io//www.youtube.com/embed/qIxSwn9l41I" frameborder="0" allowfullscreen></iframe>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[写给毛藏的使用指南]]></title>
    <link href="http://Fatman13.github.io/blog/2013/09/03/xie-gei-mao-cang-de-shi-yong-zhi-nan/"/>
    <updated>2013-09-03T16:46:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2013/09/03/xie-gei-mao-cang-de-shi-yong-zhi-nan</id>
    <content type="html"><![CDATA[<p>写给毛藏的使用指南。</p>

<!--more-->


<h1>如何安装</h1>

<p><strong>1</strong>. 下载并安装<a href="http://files.rubyforge.vm.bytemark.co.uk/railsinstaller/railsinstaller-2.2.1.exe">RailsInstaller</a>。</p>

<p><strong>2</strong>. 安装完成之后，应该会有一个<code>命令行</code>跳出来。输入以下指令。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone https://github.com/Fatman13/MaoZangLED.git
</span><span class='line'>cd MaoZangLED
</span><span class='line'>bundle install
</span><span class='line'>rake db:migrate</span></code></pre></td></tr></table></div></figure>


<p><em>注：如果有除了c盘以外其他分盘的话需要替换</em><code>bundle install</code><em>为</em><code>bundle install --path .bundle</code><em>。好像sass在windows上有bug。</em></p>

<p><strong>3</strong>. 至此安装完成。运行<code>rails s</code>，使用本地服务器。</p>

<p><strong>4</strong>. 打开浏览器。输入地址<code>localhost:3000/products</code>。</p>

<h1>如何打开服务器</h1>

<p><strong>1</strong>. 打开命令行</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd c:\Sites\MaoZangLED
</span><span class='line'>rails s</span></code></pre></td></tr></table></div></figure>


<h1>如何更新</h1>

<p><strong>1</strong>. 使用以下命令更新代码。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd c:\Sites\MaoZangLED
</span><span class='line'>git fetch --all
</span><span class='line'>git reset --hard origin/master
</span><span class='line'>bundle install --path .bundle
</span><span class='line'>rake db:migrate</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[懒人料理其4 烤牛肉]]></title>
    <link href="http://Fatman13.github.io/blog/2013/08/21/lan-ren-liao-li-qi-4-kao-niu-rou/"/>
    <updated>2013-08-21T18:51:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2013/08/21/lan-ren-liao-li-qi-4-kao-niu-rou</id>
    <content type="html"><![CDATA[<p>新食谱。</p>

<!--more-->


<h1>懒人料理宗旨</h1>

<p>制作简单，能偷懒就偷懒，但是味道还不错。一般都比较能下饭。</p>

<h1>食材</h1>

<p><img src="http://Fatman13.github.io/images/IMAG0380.resized.jpg" width="260" height="460" title="1" ></p>

<p><strong>1</strong>. 一盒切薄片的<font color="Crimson">牛肉</font>。</p>

<h1>制作方法</h1>

<p><strong>0.1</strong>. 可以用少量<font color="SaddleBrown">料酒</font>，<font color="SaddleBrown">酱油</font>事先淋在肉上。放置半个小时，帮助去除腥味。（<em>注：可选做</em>）</p>

<p><strong>1</strong>. 把炒锅加热至<strong>高温</strong>。加热至<strong>高温</strong>后可关至<strong>中温</strong>。</p>

<p><strong>2</strong>. 把<font color="Crimson">牛肉</font>一片一片小心放入锅内。视牛肉厚薄和锅子温度，翻面2，3次。看见肉被卷起来的时候需要翻面了，最好在卷起之前翻面。（<em>注意：油烟可能会很大注意排风</em>）</p>

<p><strong>3</strong>. 出锅后撒上2勺<font color="SaddleBrown">酱油</font>即可食用。</p>

<h1>出锅</h1>

<p><img src="http://Fatman13.github.io/images/IMAG0790.resized.jpg" width="555" height="313" title="1" ></p>

<p>好吃～</p>

<h1>附录</h1>

<iframe width="640" height="480" src="http://Fatman13.github.io//www.youtube.com/embed/QH2-TGUlwu4" frameborder="0" allowfullscreen></iframe>


<p>Nyan Nyan Nyan Nyan Nyan Nyan Nyan Nyan</p>

<!--肉-->


<p><font color="Crimson"></font></p>

<!--蔬菜-->


<p><font color="ForestGreen"></font></p>

<!--生肉-->


<p><font color="DeepPink"></font></p>

<!--水-->


<p><font color="DodgerBlue"></font></p>

<!--调料-->


<p><font color="SaddleBrown"></font></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How-to: Develop a RubyGem using Bundler]]></title>
    <link href="http://Fatman13.github.io/blog/2013/08/12/how-to-develop-a-rubygem-using-bundler/"/>
    <updated>2013-08-12T15:08:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2013/08/12/how-to-develop-a-rubygem-using-bundler</id>
    <content type="html"><![CDATA[<p>I am by no means a Ruby expert. This is my humble attempt of sharing what I have learned and serves as a note to future me. It should be helpful to whoever is new to Ruby and would like to have a jump start on developing a Ruby gem.</p>

<!--more-->


<h1>Prerequisites</h1>

<h3>Ruby</h3>

<p>Ruby is a powerful programming language which gains popularity with the rise of many active open source projects and communities built around it. Before thinking build some library from scratch, there might already be a free open source library which you can easily leverage. Therefore saving tons of development time.</p>

<h3>gem</h3>

<p>A <code>gem</code> is a Ruby library packaged in a standard format. You can easily download and install gems to help your development through RubyGems, which will be discussed later in the article. In a nutshell, RubyGems works a lot like <code>apt</code> or <code>yum</code>.</p>

<h3>rvm</h3>

<p><code>rvm</code> stands for Ruby enVironment Manager. <code>rvm</code> allows you to switch to a specific Ruby version and a specific set of gems for different projects. It is highly recommended that you install <code>rvm</code> to manage different versions of Ruby and gemsets for your projects.</p>

<p>To install <code>rvm</code>, do.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>curl -L https://get.rvm.io | bash -s stable –ruby</span></code></pre></td></tr></table></div></figure>


<p>To install Ruby 1.9.3, do.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rvm install 1.9.3
</span><span class='line'>rvm use 1.9.3
</span><span class='line'>rvm rubygems latest</span></code></pre></td></tr></table></div></figure>


<p>Use <code>rvm list</code> to verify your Ruby installation. Use <code>rvm list known</code> to see a list of available Ruby versions that rvm is capable of installing.</p>

<p>Notice the last command <code>rvm rubygems lastest</code> will install latest version of <code>rubygems</code>, which is a Ruby library packaging and distribution manager.</p>

<h3>RubyGems</h3>

<p>As mentioned above, with RubyGems, installing libraries published by others is made very easy.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install [gem_name]</span></code></pre></td></tr></table></div></figure>


<p>Substitute [gem_name] in above command to install the actual gem you want.</p>

<ul>
<li><p><strong>Note</strong>: A gem may depend on other gems. Therefore installing one gem may result in installing multiple other gems.</p></li>
<li><p><strong>Tip</strong>: You can specify which version of the gem you want to install by <code>gem install [gem_name] -v ‘1.0.0’</code>,  <code>gem install [gem_name] -v ‘&gt;=1.0.0’</code>, or <code>gem install [gem_name] -v ‘~&gt;1.0.0’</code></p></li>
<li><p><strong>Important</strong>: If you are using <code>rvm</code> like many people recommended, <strong>DO NOT</strong> use <code>sudo</code> when installing gems. You may come across many tutorials telling you to do things like <code>sudo gem install devise</code>. <strong>DON’T</strong> do that. Because <code>sudo</code> will mess up your <code>rvm</code>. See more details on why not using <code>sudo</code> <a href="http://rvm.io/rubies/rubygems">here</a> if you are interested.</p></li>
</ul>


<h3>Git</h3>

<p>Install git, do.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install git</span></code></pre></td></tr></table></div></figure>


<!--p2-->


<h1>Building your first gem using Bundler</h1>

<p><code>Bundler</code> is a great gem which can do a lot of things. Scaffolding a new gem is one of its many features.</p>

<p>I will be using <a href="https://github.com/Fatman13/ColorfulMD">colorfulMD</a> as an example gem for this walk through. ColorfulMD colorfies your markdown text by adding <code>&lt;font color=”a_color”&gt;&lt;/color&gt;</code> tag to certain text defined in a <code>config.yaml</code> file.</p>

<p><em>There is a very good guide <a href="https://github.com/radar/guides/blob/master/gem-development.md">here</a>. I will be explaining things that might not be too obvious. At least not so obvious to me.</em></p>

<h3>Getting started</h3>

<p>To install Bundler, do.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install bundler</span></code></pre></td></tr></table></div></figure>


<p>To create a new gem, do.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bundle gem colorfulMD</span></code></pre></td></tr></table></div></figure>


<p>This should create a new folder called <code>colorfulMD</code>. Some skeleton files and directories will be created under <code>./colorfulMD</code>.</p>

<blockquote><p>If you have Git installed, <code>bundle gem colorfulMD</code> also initializes a Git repository in <code>./colorfulMD</code> so you can start committing right away.</p></blockquote>

<ul>
<li><p><strong>Tip</strong>: You can add <code>.*~</code> and <code>*~</code> to <code>.gitignore</code> file if your text editor creates tmp file ending with <code>~</code>. This will prevent unnecessary files get pushed into your repo.</p></li>
<li><p><strong>Tip</strong>: If you are using IDEs like <code>RubyMine</code>. You may also want to add <code>.idea</code> to your <code>.gitignore</code> file.</p></li>
<li><p><strong>Tip</strong>: Usually you can define all your gem dependencies in your <code>Gemfile</code>. But <code>Bundler</code> creates <code>[gem_name].gemspec</code> file by default and defines dependencies there.</p></li>
<li><p><strong>Tip</strong>: It is a good practice that you put a <code>.rvmrc</code> like <a href="https://github.com/Fatman13/ColorfulMD/blob/master/.rvmrc">this one</a> in <code>colorfulMD</code> folder. <code>cd</code> out of <code>colorfulMD</code> folder and <code>cd</code> back in, you should see that <code>rvm</code> will initialize a independent Ruby environment for this project. This means when working in <code>colorfulMD</code> folder, you are using different Ruby version or gemsets than the global ones.</p></li>
</ul>


<h3>Following BDD</h3>

<p>I didn’t find <a href="http://en.wikipedia.org/wiki/Behavior-driven_development">BDD</a> particularly intriguing. But as for this walk through, we shall start writing our test cases even before any actual coding following BDD discipline.</p>

<p>Open <code>colorfulMD.gemspec</code> file and add the following. (<a href="https://github.com/Fatman13/ColorfulMD/blob/master/colorfulMD.gemspec">example here</a>)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">add_development_dependency</span> <span class="s2">&quot;cucumber&quot;</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">add_development_dependency</span> <span class="s2">&quot;aruba&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>
(<em><code>add_development_dependency</code> means those gems will only be installed for development use.</em>)</p>

<p><code>cucumber</code> gem and <code>aruba</code> gem are great testing tools help us generate test code following BDD discipline. (<em><a href="http://blog.jcoglan.com/2009/10/03/getting-started-with-cucumber-rspec-webrat-and-multiruby/">here</a> is a pretty good introductive tutorial for <code>cucumber</code></em>) <code>bundle install</code> is a command that goes through gemspec file, figure out the dependency and installs gems needed.</p>

<p>Run <code>bundle install</code> to install dependencies.</p>

<p>Inside <code>colorfulMD</code>, do <code>mkdir features</code>. <code>cd</code> into <code>features</code> and create directory structure and files like shown <a href="https://github.com/Fatman13/ColorfulMD/tree/master/features">here</a>.</p>

<ul>
<li><p><strong>/support</strong>: Ruby files in <code>support</code> folder will be executed before <code>cucumber</code> runs any actual tests, therefore it is good to put code that sets up environment here.</p></li>
<li><p><strong>/step_definitions</strong>: Actual test code for a feature will be in this folder.</p></li>
<li><p><strong>cli.feature</strong>: Write your feature in this file. You can name it differently.</p></li>
</ul>


<p>I put down the following into my <code>cli.feature</code> file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Feature</span><span class="p">:</span> <span class="no">CLI</span>
</span><span class='line'>  <span class="no">In</span> <span class="n">order</span> <span class="n">to</span> <span class="n">colorfy</span> <span class="n">markdown</span>
</span><span class='line'>  <span class="no">As</span> <span class="n">a</span> <span class="no">CLI</span>
</span><span class='line'>  <span class="n">I</span> <span class="n">want</span> <span class="n">to</span> <span class="n">add</span> <span class="o">&lt;</span><span class="n">font</span> <span class="n">color</span><span class="o">&gt;</span> <span class="n">tag</span> <span class="n">to</span> <span class="n">some</span> <span class="n">text</span>
</span><span class='line'>
</span><span class='line'>  <span class="ss">Scenario</span><span class="p">:</span> <span class="n">add</span> <span class="o">&lt;</span><span class="n">font</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;given_color&quot;</span><span class="o">&gt;</span> <span class="n">tag</span> <span class="n">to</span> <span class="s2">&quot;given_string&quot;</span>
</span><span class='line'>    <span class="no">Given</span> <span class="n">three</span> <span class="n">arguments</span> <span class="s2">&quot;given_color&quot;</span><span class="p">,</span> <span class="s2">&quot;given_string&quot;</span> <span class="ow">and</span> <span class="s2">&quot;text&quot;</span>
</span><span class='line'>    <span class="no">When</span> <span class="n">I</span> <span class="n">call</span> <span class="n">colorfy</span> <span class="n">of</span> <span class="no">CLI</span> <span class="n">with</span> <span class="s2">&quot;red&quot;</span> <span class="s2">&quot;apple&quot;</span> <span class="k">in</span> <span class="s2">&quot;I had an apple this afternoon&quot;</span>
</span><span class='line'>    <span class="no">Then</span> <span class="n">the</span> <span class="n">output</span> <span class="n">should</span> <span class="n">equal</span>
</span><span class='line'>      <span class="s2">&quot;&quot;&quot;</span>
</span><span class='line'><span class="s2">      I had an &lt;font color=&quot;</span><span class="n">red</span><span class="s2">&quot;&gt;apple&lt;/font&gt; this afternoon</span>
</span><span class='line'><span class="s2">      &quot;&quot;&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>It doesn’t seem to really matter what you put right after <code>Feature:</code> and <code>Scenario:</code>.  The main thing you want to define here is what follows <code>Given</code>, <code>When</code> and <code>Then</code> keywords. It is relatively comprehensive. <code>Given</code> defines what argument(s) your method is taking. (<em>you don’t need <code>given</code> if you are not going to do anything fancy with the arguments</em>) I specified values of the three arguments with <code>When</code> keyword. Note how close the test case is to natural language. That is supposed to be the beauty of BDD. Given the arguments specified after <code>When</code>, I put down the expected output after <code>Then</code> keyword. Triple quotes was used for escaping the quotes in the expected output.</p>

<p>After all that, run <code>bundle exec cucumber features/</code>.  Copy paste the output after <code>You can implement step definitions for undefined steps with these snippets:
</code> to <code>/step_definitions/colorfy_steps.rb</code>. (<em>you should copy paste something close to the below</em>)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Given</span><span class="p">(</span><span class="sr">/^three arguments &quot;(.*?)&quot;, &quot;(.*?)&quot; and &quot;(.*?)&quot;$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="o">|</span>
</span><span class='line'>  <span class="n">pending</span> <span class="c1"># express the regexp above with the code you wish you had</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">When</span><span class="p">(</span><span class="sr">/^I call colorfy of CLI with &quot;(.*?)&quot; &quot;(.*?)&quot; in &quot;(.*?)&quot;$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="o">|</span>
</span><span class='line'>  <span class="n">pending</span> <span class="c1"># express the regexp above with the code you wish you had</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Then</span><span class="p">(</span><span class="sr">/^the output should equal$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">string</span><span class="o">|</span>
</span><span class='line'>  <span class="n">pending</span> <span class="c1"># express the regexp above with the code you wish you had</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now add some actual testing code to <code>colorfy_steps.rb</code> like shown <a href="https://github.com/Fatman13/ColorfulMD/blob/master/features/step_definitions/colorfy_steps.rb">here</a>.</p>

<h3>Implementing CLI</h3>

<p>Add <code>spec.add_dependency "thor"</code> to your <code>gemspec</code> file. And run <code>bundle install</code>.</p>

<p>At project root, do <code>mkdir lib/colorfulMD</code>, <code>touch lib/colorfulMD/cli.rb</code> and <code>touch lib/colorfulMD/colorfulMD.rb</code>. Paste the following to <code>cli.rb</code> and <code>colorfulMD.rb</code> respectively.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># $LOAD_PATH.unshift(File.dirname(__FILE__))</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;thor&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;colorfulMD&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">module</span> <span class="nn">ColorfulMD</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">CLI</span> <span class="o">&lt;</span> <span class="no">Thor</span>
</span><span class='line'>    <span class="n">desc</span> <span class="s2">&quot;colorfy GIVEN_COLOR GIVEN_STRING TEXT&quot;</span><span class="p">,</span> <span class="s2">&quot;colorfy a given word by a given color defined in yaml&quot;</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">colorfy</span><span class="p">(</span><span class="n">given_color</span><span class="p">,</span> <span class="n">given_string</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span class='line'>        <span class="n">clrmd</span> <span class="o">=</span> <span class="ss">ColorfulMD</span><span class="p">:</span><span class="ss">:Colorfulmd</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>        <span class="n">clrmd</span><span class="o">.</span><span class="n">colorfy</span><span class="p">(</span><span class="n">given_color</span><span class="p">,</span> <span class="n">given_string</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">ColorfulMD</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Colorfulmd</span>
</span><span class='line'>        <span class="c1"># colorfy</span>
</span><span class='line'>        <span class="k">def</span> <span class="nf">colorfy</span><span class="p">(</span><span class="n">given_color</span><span class="p">,</span> <span class="n">given_string</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span class='line'>          <span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="n">given_string</span><span class="p">,</span> <span class="s2">&quot;&lt;font color=</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">given_color</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&gt;&quot;</span> <span class="o">+</span> <span class="n">given_string</span> <span class="o">+</span> <span class="s2">&quot;&lt;/font&gt;&quot;</span> <span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>At this point, if you run <code>bundle exec cucumber features</code>, you should see you have passed all cucumber test! Systems all green!</p>

<p>And now we just need to make a cli executable.</p>

<p>At project root, do <code>mkdir bin</code>. Do <code>touch bin/colorfulMD</code> and <code>sudo chmod +x bin/colorfulMD</code>. <code>bin/colorfulMD</code> will be your CLI executable for your gem. Paste the following code to <code>bin/colorfulMD</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/bin/env ruby</span>
</span><span class='line'><span class="vg">$LOAD_PATH</span><span class="o">.</span><span class="n">unshift</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/../lib/colorfulMD&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;colorfulMD/cli&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;colorfulMD&#39;</span>
</span><span class='line'><span class="ss">ColorfulMD</span><span class="p">:</span><span class="ss">:CLI</span><span class="o">.</span><span class="n">start</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run your executable by <code>bundle exec bin/colorfulMD colorfy red apple apple</code>. You can modify the code to have colorfy method output string by replacing <code>text.gsub(given_string, "&lt;font color=\"" + given_color + "\"&gt;" + given_string + "&lt;/font&gt;" )</code> with <code>puts text.gsub(given_string, "&lt;font color=\"" + given_color + "\"&gt;" + given_string + "&lt;/font&gt;" )</code> in <code>colorfulMD.rb</code>.</p>

<p>This concludes the tutorial.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[东周列国传 读中感]]></title>
    <link href="http://Fatman13.github.io/blog/2013/08/05/dong-zhou-lie-guo-chuan-du-zhong-gan/"/>
    <updated>2013-08-05T12:25:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2013/08/05/dong-zhou-lie-guo-chuan-du-zhong-gan</id>
    <content type="html"><![CDATA[<p>这次又是一篇随笔。“读中感”，顾名思义，是与读后感相对，为还在读的时候有感而发。</p>

<!--more-->


<h1>概要</h1>

<p>看<a href="http://baike.baidu.com/view/2674.htm#sub5089533">东周列国传</a>源于之前看<a href="http://baike.baidu.com/view/1306119.htm#sub9272586">王者天下</a>，突然有了阅读的欲望。读着读着，发现有很多有趣的故事。在这儿做个笔记。</p>

<h1>基情篇</h1>

<!--人名-->


<p><font color="Chocolate"></font></p>

<!--诗词-->


<p><font color="GoldenRod"></font></p>

<p>感觉这个故事很戏剧，或可改拍电影。是一片好的阅读。以下是原文摘录。为方便阅读，使用了<a href="https://github.com/Fatman13/ColorfulMD">colofulMD</a>帮人名加上了颜色。呵呵。</p>

<blockquote><p>却说<font color="Chocolate">卫宣公</font>名晋，为人淫纵不检。自为公子时，与其父<font color="Chocolate">庄公</font>之妾名<font color="Chocolate">夷姜</font>者私通，生下一子，寄养于民间，取名曰<font color="Chocolate">急子</font>。<font color="Chocolate">宣公</font>即位之日，元配<font color="Chocolate">邢妃</font>无宠，只有<font color="Chocolate">夷姜</font>得幸，如同夫妇，就许立<font color="Chocolate">急子</font>为嗣，属之于右公子职。时<font color="Chocolate">急子</font>长成，已一十六岁，为之聘<font color="Chocolate">齐僖公</font>长女。使者返国，<font color="Chocolate">宣公</font>闻齐女有绝世之姿，心贪其色，而难于启口，乃构名匠筑高台于淇河之上，朱栏华栋，重宫复室，极其华丽，名曰新台。先以聘宋为名，遣开<font color="Chocolate">急子</font>，然后使左<font color="Chocolate">公子泄</font>如齐，迎<font color="Chocolate">姜氏</font>径至新台，自己纳之，是为<font color="Chocolate">宣姜</font>，时人作新台之诗，以刺其淫乱：</p>

<blockquote><p><font color="GoldenRod">新台有泚，河水弥弥。<br/>
燕婉之求，籧篨不鲜。<br/>
鱼网之设，鸿则离之。<br/>
燕婉之求，得此戚施。</font></p></blockquote>

<p><font color="Chocolate">籧篨</font>、<font color="Chocolate">戚施</font>，皆丑恶之貌，以喻宣公。言<font color="Chocolate">姜氏</font>本求佳偶，不意乃配此丑恶也。后人读史至此，言齐僖公二女，长<font color="Chocolate">宣姜</font>，次<font color="Chocolate">文姜</font>，<font color="Chocolate">宣姜</font>淫于舅，<font color="Chocolate">文姜</font>淫于兄，人伦天理，至此灭绝矣！有诗叹曰：</p>

<blockquote><p><font color="GoldenRod">妖艳春秋首二姜，致令齐卫紊纲常。<br/>
天生尤物殃人国，不及无盐佐伯王！</font></p></blockquote>

<p><font color="Chocolate">急子</font>自宋回家，复命于新台，<font color="Chocolate">宣公</font>命以庶母之礼谒见<font color="Chocolate">姜氏</font>，<font color="Chocolate">急子</font>全无几微怨恨之意。<font color="Chocolate">宣公</font>自纳齐女，只往新台朝欢暮乐，将<font color="Chocolate">夷姜</font>又撇一边，一住三年，与<font color="Chocolate">齐姜</font>连生二子，长曰<font color="Chocolate">寿</font>，次曰<font color="Chocolate">朔</font>。自古道：“母爱子贵”，<font color="Chocolate">宣公</font>因偏宠<font color="Chocolate">齐姜</font>，将昔日怜爱<font color="Chocolate">急子</font>之情，都移在<font color="Chocolate">寿</font>与<font color="Chocolate">朔</font>身上，心中便想百年之后，把卫国江山传与<font color="Chocolate">寿</font>、<font color="Chocolate">朔</font>兄弟，他便心满意足，反似多了<font color="Chocolate">急子</font>一人。只因<font color="Chocolate">公子寿</font>天性孝友，与<font color="Chocolate">急子</font>如同胞一般相爱，每在父母面前，周旋其兄。那<font color="Chocolate">急子</font>又温柔敬慎，无有失德，所以<font color="Chocolate">宣公</font>未曾显露其意。私下将<font color="Chocolate">公子寿</font>嘱托左<font color="Chocolate">公子泄</font>，异日扶他为君。那公子<font color="Chocolate">朔</font>虽与寿一母所生，贤愚迥然不同，年齿尚幼，天生狡猾，恃其母之得宠，阴蓄死士，心怀非望。不惟憎嫌急子，并亲兄<font color="Chocolate">公子寿</font>，也象<a href="http://baike.baidu.com/view/535679.htm">赘疣</a>一般。只是事有缓急，先除<font color="Chocolate">急子</font>要紧。常把说话挑激母亲，说：“父亲眼下虽然将我母子看待，有<font color="Chocolate">急子</font>在先，他为兄，我等为弟，异日传位，蔑不得长幼之序。况<font color="Chocolate">夷姜</font>被你夺宠，心怀积忿，若<font color="Chocolate">急子</font>为君，彼为国母，我母子无安身之地矣！”<font color="Chocolate">齐姜</font>原是<font color="Chocolate">急子</font>所聘，今日跟随<font color="Chocolate">宣公</font>，生子得时，也觉<font color="Chocolate">急子</font>与己有碍，遂与<font color="Chocolate">公子朔</font>合谋，每每谗谮<font color="Chocolate">急子</font>于父亲之前。一日，<font color="Chocolate">急子</font>诞日，<font color="Chocolate">公子寿</font>治酒相贺，<font color="Chocolate">朔</font>亦与席。坐间<font color="Chocolate">急子</font>与<font color="Chocolate">公子寿</font>说话甚密。<font color="Chocolate">公子朔</font>插嘴不下，托病先别，一径到母亲<font color="Chocolate">齐姜</font>面前，双眼垂泪，扯个大谎，告诉道：“孩儿好意同自己哥哥与<font color="Chocolate">急子</font>上寿，<font color="Chocolate">急子</font>饮酒半酣，戏谑之间，呼孩儿为儿子。孩儿心中不平，说他几句，他说：‘你母亲原是我的妻子，你便称我为父，于理应该。&#8217;孩儿再待开口，他便奋臂要打，亏自己哥哥劝住，孩儿逃席而来。受此大辱，望母亲禀知父侯，与孩儿做主！”<font color="Chocolate">齐姜</font>信以为然，待<font color="Chocolate">宣公</font>入宫，呜呜咽咽的告诉出来，如此如此，这般这般，又装点几句道：“他还要玷污妾身，说：‘我母<font color="Chocolate">夷姜</font>，原是父亲的庶母，尚然收纳为妻。况你母亲原是我旧妻，父亲只算借贷一般，少不得与卫国江山一同还我。&#8217;”<font color="Chocolate">宣公</font>召<font color="Chocolate">公子寿</font>问之，<font color="Chocolate">寿</font>答曰：“并无此说。”<font color="Chocolate">宣公</font>半疑半信，但遣内侍传谕<font color="Chocolate">夷姜</font>，责备他不能教训其子。<font color="Chocolate">夷姜</font>怨气填胸，无处伸诉，投缳而死。髯翁有诗叹曰：</p>

<blockquote><p><font color="GoldenRod">父妾如何与子通？聚麀传笑卫淫风。<br/>
夷姜此日投缳晚，何似当初守节终！</font></p></blockquote>

<p><font color="Chocolate">急子</font>痛念其母，惟恐父亲嗔怪，暗地啼哭。<font color="Chocolate">公子朔</font>又与<font color="Chocolate">齐姜</font>谤说<font color="Chocolate">急子</font>，因生母死于非命，口出怨言，日后要将母子偿命。<font color="Chocolate">宣公</font>本不信有此事，无奈妒妾谗子，日夜撺掇，定要<font color="Chocolate">宣公</font>杀<font color="Chocolate">急子</font>，以绝后患，不由<font color="Chocolate">宣公</font>不听。但展转踌躇，终是杀之无名，必须假手他人，死于道路，方可掩人耳目。其时，适<font color="Chocolate">齐僖公</font>约会伐纪，征兵于卫。<font color="Chocolate">宣公</font>乃与<font color="Chocolate">公子朔</font>商议，假以往订师期为名，遣<font color="Chocolate">急子</font>如齐，授以白旄。此去莘野，是往齐的要路，舟行至此，必然登陆，在彼安排<font color="Chocolate">急子</font>，他必不作准备。<font color="Chocolate">公子朔</font>向来私蓄死士，今日正用得著，教他假装盗贼，伏于莘野，只认白旄过去，便赶出一齐下手，以旄复命，自有重赏。<font color="Chocolate">公子朔</font>处分已定，回复<font color="Chocolate">齐姜</font>，<font color="Chocolate">齐姜</font>心下十分欢喜。</p>

<p>却说<font color="Chocolate">公子<font color="Chocolate">寿</font></font>见父亲屏去从人，独召弟朔议事，心怀疑惑。入宫来见母亲，探其语气。<font color="Chocolate">齐姜</font>不知隐瞒，尽吐其实。嘱咐曰：“此乃汝父主意，欲除我母子后患，不可泄漏他人。”<font color="Chocolate">公子<font color="Chocolate">寿</font></font>知其计已成，谏之无益，私下来见<font color="Chocolate">急子</font>，告以父亲之计：“此去莘野必由之路，多凶少吉。不如出奔他国，别作良图。”<font color="Chocolate">急子</font>曰：“为人子者，以从命为孝。弃父之命，即为逆子。世间岂有无父之国？即欲出奔，将安往哉？”遂束装下舟，毅然就道。<font color="Chocolate">公子<font color="Chocolate">寿</font></font>泣劝不从，思想：“吾兄真仁人也！此行若死于盗贼之手，父亲立我为嗣，何以自明？子不可以无父，弟不可以无兄，吾当先兄而行，代他一死，吾兄必然获免。父亲闻吾之死，倘能感悟，慈孝两全，落得留名万古！”于是别以一舟载酒，亟往河下，请<font color="Chocolate">急子</font>饯别。<font color="Chocolate">急子</font>辞以“君命在身，不敢逗遛。”<font color="Chocolate">公子<font color="Chocolate">寿</font></font>乃移樽过舟，满斟以进。未及开言，不觉泪珠堕于杯中，<font color="Chocolate">急子</font>忙接而饮之。<font color="Chocolate">公子<font color="Chocolate">寿</font></font>曰：“酒已污矣！”<font color="Chocolate">急子</font>曰：“正欲饮吾弟之情也！”<font color="Chocolate">公子<font color="Chocolate">寿</font></font>拭泪言曰：“今日此酒，乃吾弟兄永诀之酒。哥哥若鉴小弟之情，多饮几杯！”<font color="Chocolate">急子</font>曰：“敢不尽量？”两人泪眼相对，彼此劝酬。<font color="Chocolate">公子<font color="Chocolate">寿</font></font>有心留量，<font color="Chocolate">急子</font>到手便吞，不觉尽醉，倒于席上，鼾鼾睡去。<font color="Chocolate">公子<font color="Chocolate">寿</font></font>谓从人曰：“君命不可迟也，我当代往！”即取<font color="Chocolate">急子</font>手中白旄，故意建于舟首，用自己仆从相随。嘱咐<font color="Chocolate">急子</font>随行人众，好生守候。袖中出一简，付之曰：“俟世子酒醒后，可呈看也！”即命发舟。行近莘野，方欲整车登岸，那些埋伏的死士，望见河中行旌飘飏，认得白旄，定是<font color="Chocolate">急子</font>到来，一声呼哨，如蜂而集$<font color="Chocolate">公子<font color="Chocolate">寿</font></font>挺然出喝曰：“吾乃本国<font color="Chocolate">卫侯</font>长子，奉使往齐，汝等何人，敢来邀截？”众贼齐声曰：“吾等奉<font color="Chocolate">卫侯</font>密旨，来取汝首！”挺刀便砍。从者见势头凶猛，不知来历，一时惊散。可怜<font color="Chocolate">寿子</font>引颈受刀，贼党取头，盛于木匣，一齐下船，偃旄而归。</p>

<p>再说<font color="Chocolate">急子</font>酒量原浅，一时便醒，不见了<font color="Chocolate">公子<font color="Chocolate">寿</font></font>，从人将简缄呈上，<font color="Chocolate">急子</font>拆而看之，简上只有八个字云：“弟已代行，兄宜速避！”<font color="Chocolate">急子</font>不觉堕泪曰：“弟为我犯难，吾当速往，不然恐误杀吾弟也！”喜得仆从俱在，就乘了<font color="Chocolate">公子<font color="Chocolate">寿</font></font>之舟，催趱舟人速行，真个似电流光绝，鸟逝超群。其夜月明如水，<font color="Chocolate">急子</font>心念其弟，目不交睫，注视益鸟首之前，望见<font color="Chocolate">公子<font color="Chocolate">寿</font></font>之舟，喜曰：“天幸吾弟尚在。”从人禀曰：“此来舟，非去舟也！”<font color="Chocolate">急子</font>心疑，教拢船上去。两船相近，楼橹俱明，只见舟中一班贼党，并不见<font color="Chocolate">公子<font color="Chocolate">寿</font></font>之面。<font color="Chocolate">急子</font>愈疑，乃佯问曰：“主公所命，曾了事否？”众贼听得说出秘密，却认为<font color="Chocolate">公子朔</font>差来接应的，乃捧函以对曰：“事已了矣！”<font color="Chocolate">急子</font>取函启视，见是<font color="Chocolate">公子<font color="Chocolate">寿</font></font>之首，仰天大哭曰：“天乎冤哉！”众贼骇然，问曰：“父杀其子，何故称冤？”<font color="Chocolate">急子</font>曰：“我乃真<font color="Chocolate">急子</font>也，得罪于父，父命杀我。此吾弟<font color="Chocolate">寿</font>也，何罪而杀之？可速断我头，归献父亲，可赎误杀之罪！”贼党中有认得二公子者，于月下细认之曰：“真误矣！”众贼遂将<font color="Chocolate">急子</font>斩首，并纳函中，从人亦皆四散。《卫风》有《乘舟》之诗，正咏兄弟争死之事。诗曰：</p>

<blockquote><p><font color="GoldenRod">二子乘舟，泛泛其景，<br/>
愿言思子，中心养养。<br/>
二子乘舟，泛泛其逝，<br/>
愿言思子，不瑕有害。</font></p></blockquote>

<p>诗人不敢明言，但追想乘舟之人，以寓悲思之意也。再说众贼连夜奔入卫城，先见<font color="Chocolate">公子朔</font>，呈上白旄，然后将二子先后被杀事情，细述一遍，犹恐误杀得罪。谁知一箭射双雕，正中了<font color="Chocolate">公子朔</font>的隐怀，自出金帛，厚赏众贼，却入宫来见母亲说：“<font color="Chocolate">公子<font color="Chocolate">寿</font></font>载旌先行，自损其命，喜得<font color="Chocolate">急子</font>后到，天教他自吐真名，偿了哥哥之命。”<font color="Chocolate">齐姜</font>虽痛<font color="Chocolate">公子<font color="Chocolate">寿</font></font>，却幸除了<font color="Chocolate">急子</font>，拔去眼中之钉，正是忧喜相半。母子商量，且教慢与<font color="Chocolate">宣公</font>说知。却说左<font color="Chocolate">公子泄</font>，原受<font color="Chocolate">急子</font>之托；右<font color="Chocolate">公子职</font>，原受<font color="Chocolate">公子<font color="Chocolate">寿</font></font>之托，二人各自关心，遣人打探消息，回报如此如此。起先未免各为其主，至此同病相怜，合在一处商议。候<font color="Chocolate">宣公</font>早朝，二人直入朝堂，拜倒在地，放声大哭。<font color="Chocolate">宣公</font>惊问何故，<font color="Chocolate">公子泄</font>、<font color="Chocolate">公子职</font>二人一辞，将<font color="Chocolate">急子</font>与<font color="Chocolate">公子<font color="Chocolate">寿</font></font>被杀情由，细述一遍，“乞收拾尸首埋葬，以尽当初相托之情。”说罢哭声转高。<font color="Chocolate">宣公</font>虽怪<font color="Chocolate">急子</font>，却还怜爱<font color="Chocolate">公子<font color="Chocolate">寿</font></font>，忽闻二子同时被害，吓得面如土色，半晌不言。痛定生悲，泪如雨下，连声叹曰：“<font color="Chocolate">齐姜</font>误我，<font color="Chocolate">齐姜</font>误我！”即召<font color="Chocolate">公子朔</font>问之，朔辞不知。<font color="Chocolate">宣公</font>大怒，就著<font color="Chocolate">公子朔</font>拘拿杀人之贼，<font color="Chocolate">公子朔</font>口中应承，只是支吾，哪肯献出贼党？<font color="Chocolate">宣公</font>自受惊之后，又想念<font color="Chocolate">公子<font color="Chocolate">寿</font></font>，感成一病，闭眼便见<font color="Chocolate">夷姜</font>、<font color="Chocolate">急子</font>、<font color="Chocolate">寿</font>子一班，在前啼啼哭哭。祈祷不效，半月而亡。<font color="Chocolate">公子朔</font>发丧袭位，是为惠公。时朔年一十五岁，将左右二公子罢官不用。庶兄<font color="Chocolate">公子硕</font>字昭伯，心中不服，连夜奔齐。<font color="Chocolate">公子泄</font>与<font color="Chocolate">公子职</font>怨恨惠公，每思为<font color="Chocolate">急子</font>及<font color="Chocolate">公子<font color="Chocolate">寿</font></font>报仇，未得其便。<br/>
&mdash;<cite>《<a href="http://baike.baidu.com/view/2674.htm#sub5089533">东周列国传</a>》第012回 卫<font color="Chocolate">宣公</font>筑台纳媳 高渠弥乘间易君</cite></p></blockquote>

<p>最后的那篇诗评确是很有意境。</p>

<h1>乱伦篇</h1>

<p>这个故事也很戏剧。为大家介绍一下大概的故事背景。东周有齐国（下左）和鲁国（下右）。两国也是和和战战，战战和和。齐僖公有二女，长女嫁于卫，即上文提到的卫宣姜，次女文姜，嫁于鲁柦(dan)公。齐僖公死后，其子即位，是为齐襄公。齐襄公与文姜虽为兄妹，各自一母。</p>

<table><tr><td>
<iframe width="425" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://maps.google.com/maps?q=37.614231,116.40747&amp;num=1&amp;t=k&amp;ie=UTF8&amp;ll=37.03764,117.004395&amp;spn=27.548148,64.775391&amp;z=5&amp;output=embed"></iframe><br /><small><a href="https://maps.google.com/maps?q=37.614231,116.40747&amp;num=1&amp;t=k&amp;ie=UTF8&amp;ll=37.03764,117.004395&amp;spn=27.548148,64.775391&amp;z=5&amp;source=embed" style="color:#0000FF;text-align:left">View Larger Map</a></small>
</td>
<td>
<iframe width="425" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://maps.google.com/maps?q=36.597889,115.437011&amp;num=1&amp;t=k&amp;ie=UTF8&amp;ll=37.439974,116.323242&amp;spn=27.696132,64.775391&amp;z=5&amp;output=embed"></iframe><br /><small><a href="https://maps.google.com/maps?q=36.597889,115.437011&amp;num=1&amp;t=k&amp;ie=UTF8&amp;ll=37.439974,116.323242&amp;spn=27.696132,64.775391&amp;z=5&amp;source=embed" style="color:#0000FF;text-align:left">View Larger Map</a></small>
</td></tr></table>


<blockquote><p>却说<font color="Chocolate">齐<font color="Chocolate">襄公</font></font>见<font color="Chocolate">祭足</font>来聘，欣然接之。正欲报聘，忽闻<font color="Chocolate">高渠弥</font>弑了<font color="Chocolate">昭公</font>，援立<font color="Chocolate">子亹</font>，心中大怒，便有兴兵诛讨之意。因<font color="Chocolate">鲁侯夫妇</font>将至齐国，且将郑事搁起，亲至泺水迎候。却说鲁夫人<font color="Chocolate">文姜</font>见齐使来迎，心下亦想念其兄，欲借归宁之名，与<font color="Chocolate">桓公</font>同行。<font color="Chocolate">桓公</font>溺爱其妻，不敢不从。大夫<font color="Chocolate">申繻</font>谏曰：“‘女有室，男有家&#8217;，古之制也。礼无相渎，渎则有乱。女子出嫁，父母若在，每岁一归宁。今夫人父母俱亡，无以妹宁兄之理。鲁以秉礼为国，岂可行此非礼之事？”<font color="Chocolate">桓公</font>已许<font color="Chocolate">文姜</font>，遂不从<font color="Chocolate">申繻</font>之谏，夫妇同行。车至泺水，<font color="Chocolate">齐<font color="Chocolate">襄公</font></font>早先在矣。殷勤相接，各叙寒温，一同发驾，来到临淄。鲁侯致周王之命，将婚事议定。<font color="Chocolate">齐侯</font>十分感激，先设大享，款待<font color="Chocolate">鲁侯夫妇</font>。然后迎<font color="Chocolate">文姜</font>至于宫中，只说与旧日宫嫔相会。谁知<font color="Chocolate">襄公</font>预造下密室，另治私宴，与<font color="Chocolate">文姜</font>叙情。饮酒中间，四目相视，你贪我爱，不顾天伦，遂成苟且之事。两下迷恋不舍，遂留宿宫中，日上三竿，尚相抱未起，撇却鲁<font color="Chocolate">桓公</font>在外，冷冷清清。鲁侯心中疑虑，遣人至宫门细访，回报：“<font color="Chocolate">齐侯</font>未娶正妃，止有偏宫<font color="Chocolate">连氏</font>，乃大夫<font color="Chocolate">连称</font>之从妹，向来失宠，<font color="Chocolate">齐侯</font>不与相处。姜夫人自入齐宫，只是兄妹叙情，并无他宫嫔相聚。”鲁侯情知不做好事，恨不得一步跨进齐宫，观其动静。恰好人报：“国母出宫来了。”鲁侯盛气以待，便问<font color="Chocolate">姜氏</font>曰：“夜来宫中共谁饮酒？”答曰：“同<font color="Chocolate">连妃</font>。”又问：“几时散席？”答：“久别话长，直到粉墙月上，可半夜矣。”又问：“你兄曾来陪饮否？”答曰：“我兄不曾来。”鲁侯笑而问曰：“难道兄妹之情，不来相陪？”<font color="Chocolate">姜氏</font>曰：“饮至中间，曾来相劝一杯，即时便去。”鲁侯曰：“你席散如何不出宫？”<font color="Chocolate">姜氏</font>曰：“夜深不便。”鲁侯又问曰：“你在何处安置？”<font color="Chocolate">姜氏</font>曰：“君侯差矣，何必盘问至此。宫中许多空房，岂少下榻之处，妾自在西宫过宿，即昔年守闺之所也。”鲁侯曰：“你今日如何起得恁迟？”<font color="Chocolate">姜氏</font>曰：“夜来饮酒劳倦，今早梳妆，不觉过时。”鲁侯又问曰：“宿处谁人相伴？”<font color="Chocolate">姜氏</font>曰：“宫娥耳。”鲁侯又曰：“你兄在何处睡？”<font color="Chocolate">姜氏</font>不觉面赤曰：“为妹的怎管哥哥睡处，言之可笑！”鲁侯曰：“只怕为哥的倒要管妹子睡处。”<font color="Chocolate">姜氏</font>曰：“是何言也？”鲁侯曰：“自古男女有别，你留宿宫中，兄妹同宿，寡人已尽知之，休得瞒隐。”<font color="Chocolate">姜氏</font>口中虽是含糊抵赖，啼啼哭哭，心中却也十分惭愧。”鲁<font color="Chocolate">桓公</font>身在齐国，无可奈何，心中虽然忿恨，却不好发作出来。正是“敢怒而不敢言”，即遣人告辞<font color="Chocolate">齐侯</font>，且待归国，再作区处。却说<font color="Chocolate">齐<font color="Chocolate">襄公</font></font>自知做下不是，<font color="Chocolate">姜氏</font>出宫之时，难以放心，便密遣心腹力士<font color="Chocolate">石之纷如</font>跟随，打听<font color="Chocolate">鲁侯夫妇</font>相见有何说话。<font color="Chocolate">石之纷如</font>回复：“鲁侯与夫人角口，如此如此。”<font color="Chocolate">襄公</font>大惊曰：“亦料鲁侯久后必知，何其早也！”少顷，见鲁使来辞，明知事泄之故，乃固请于牛山一游，便作饯行，使人连逼几次，鲁侯只得命驾出郊，<font color="Chocolate">文姜</font>自留邸舍，闷闷不悦。</p>

<p>却说<font color="Chocolate">齐<font color="Chocolate">襄公</font></font>一来舍不得<font color="Chocolate">文姜</font>回去，二来惧鲁侯怀恨成仇，一不做，二不休，吩咐<font color="Chocolate">公子<font color="Chocolate">彭生</font></font>待席散之后，送鲁侯回邸，要在车中结果鲁侯性命。<font color="Chocolate">彭生</font>记起战纪时一箭之恨，欣然领命。是日牛山大宴，盛陈歌舞，<font color="Chocolate">襄公</font>意倍殷勤，鲁侯只低头无语，<font color="Chocolate">襄公</font>教诸大夫轮流把盏，又教宫娥内侍，捧樽跪劝，鲁侯心中愤郁，也要借杯浇闷，不觉酩酊大醉，别时不能成礼，<font color="Chocolate">襄公</font>使<font color="Chocolate">公子<font color="Chocolate">彭生</font></font>抱之上车，<font color="Chocolate">彭生</font>遂与鲁侯同载，离国门约有二里，<font color="Chocolate">彭生</font>见鲁侯熟睡，挺臂以拉其胁，<font color="Chocolate">彭生</font>力大，其臂如铁，鲁侯被拉胁折，大叫一声，血流满车而死。<font color="Chocolate">彭生</font>谓众人曰：“鲁侯醉后中恶，速驰入城，报知主公。”众人虽觉蹊跷，谁敢多言。史臣有诗云：</p>

<blockquote><p>男女嫌微最要明，夫妻越境太胡行。<br/>
当时若听<font color="Chocolate">申繻</font>谏，何至车中六尺横？</p></blockquote>

<p><font color="Chocolate">齐<font color="Chocolate">襄公</font></font>闻鲁侯暴薨，佯啼假哭，即命厚殓入棺，使人报鲁迎丧，鲁之从人回国，备言车中被弑之由。大夫申曰：“国不可一日无君，且扶<font color="Chocolate">世子同</font>主张丧事，候丧车到日，行即位礼。”<font color="Chocolate">公子<font color="Chocolate">庆父</font></font>字孟，乃<font color="Chocolate">桓公</font>之庶长子，攘臂言曰：“<font color="Chocolate">齐侯</font>乱伦无礼，祸及君父，愿假我戎车三百乘，伐齐声罪。”大夫<font color="Chocolate">申繻</font>惑其言，私以问谋士<font color="Chocolate">施伯</font>曰：“可伐齐否？”<font color="Chocolate">施伯</font>曰：“此暖昧之事，不可闻于邻国。况鲁弱齐强，伐未可必胜，反彰其丑。不如含忍，姑请究车中之故，使齐杀<font color="Chocolate">公子<font color="Chocolate">彭生</font></font>，以解说于列国。齐必听从。”<font color="Chocolate">申繻</font>告于<font color="Chocolate">庆父</font>，遂使<font color="Chocolate">施伯</font>草成国书之稿，世子居丧不言，乃用大夫出名遣人如齐，致书迎丧。<font color="Chocolate">齐<font color="Chocolate">襄公</font></font>启书看之，书曰：</p>

<p>外臣<font color="Chocolate">申繻</font>等，拜上<font color="Chocolate">齐侯</font>殿下：寡君奉天子之命，不敢宁居，来议大婚。今出而不入，道路纷纷，皆以车中之变为言。无所归咎，耻辱播于诸侯。请以<font color="Chocolate">彭生</font>正罪。</p>

<p><font color="Chocolate">襄公</font>览毕，即遣人召<font color="Chocolate">彭生</font>入朝。<font color="Chocolate">彭生</font>自谓有功，昂然而入。<font color="Chocolate">襄公</font>当鲁使之面骂曰：“寡人以鲁侯过酒，命尔扶持上车，何不小心伏侍，使其暴甍。尔罪难辞！”喝令左右缚之，斩于市曹。<font color="Chocolate">彭生</font>大呼曰：“淫其妹而杀其夫，皆出汝无道昏君所为，今日又委罪于我。死而有知，必为妖孽，以取尔命！”<font color="Chocolate">襄公</font>遽自掩其耳，左右皆笑。<font color="Chocolate">襄公</font>一面遣人往周王处谢婚，并订娶期；一面遣人送鲁侯丧车回国，<font color="Chocolate">文姜</font>仍留齐不归。鲁大夫<font color="Chocolate">申繻</font>率<font color="Chocolate">世子同</font>迎柩至郊，即于柩前行礼成丧，然后嗣位，是为<font color="Chocolate">庄公</font>。<font color="Chocolate">申繻</font>、<font color="Chocolate"><font color="Chocolate">颛孙生</font></font>、<font color="Chocolate">公子溺</font>、<font color="Chocolate">公子偃</font>、<font color="Chocolate">曹沫</font>一班文武，重整朝纲。庶兄<font color="Chocolate">公子<font color="Chocolate">庆父</font></font>、庶弟<font color="Chocolate">公子牙</font>、嫡弟<font color="Chocolate">季友</font>俱参国政。<font color="Chocolate">申繻</font>荐<font color="Chocolate">施伯</font>之才，亦拜上士之职。以明年改元，实<font color="Chocolate">周<font color="Chocolate">庄王</font></font>之四年也。</p>

<p>鲁<font color="Chocolate">庄公</font>集群臣商议，为齐迎婚之事。<font color="Chocolate">施伯</font>曰：“国有三耻，君知之乎？”<font color="Chocolate">庄公</font>曰：“何谓三耻？”<font color="Chocolate">施伯</font>曰：“先君虽已成服，恶名在口，一耻也；君夫人留齐未归，引人议论，二耻也；齐为仇国，况君在衰绖之中，乃为主婚，辞之则逆王命，不辞则贻笑于人，三耻也！”鲁<font color="Chocolate">庄公</font>蹴然曰：“此三耻何以免之？”<font color="Chocolate">施伯</font>曰：“欲人勿恶，必先自美；欲人勿疑，必先自信。先君之立，未膺王命，若乘主婚之机，请命于周，以荣名被之九泉，则一耻免矣！君夫人在齐，宜以礼迎之，以成主公之孝，则二耻免矣！惟主婚一事，最难两全，然亦有策。”<font color="Chocolate">庄公</font>曰：“其策何如？”<font color="Chocolate">施伯</font>曰：“可将王姬馆舍，筑于郊外，使上大夫迎而送之，君以丧辞。上不逆天王之命，下不拂大国之情，中不失居丧之礼，如此则三耻亦免矣！”<font color="Chocolate">庄公</font>曰：“<font color="Chocolate">申繻</font>言汝‘智过于腹&#8217;，果然！”遂一一依策而行。却说鲁使大夫<font color="Chocolate"><font color="Chocolate">颛孙生</font></font>至周，请迎王姬，因请以黻冕圭璧，为先君泉下之荣。<font color="Chocolate">周<font color="Chocolate">庄王</font></font>许之，择人使鲁，锡<font color="Chocolate">桓公</font>命。<font color="Chocolate">周公<font color="Chocolate">黑肩</font></font>愿行，<font color="Chocolate">庄王</font>不许，别遣大夫荣叔。原来<font color="Chocolate">庄王</font>之弟<font color="Chocolate">王<font color="Chocolate">子克</font></font>，有宠于先王，<font color="Chocolate">周公<font color="Chocolate">黑肩</font></font>曾受临终之托，<font color="Chocolate">庄王</font>疑<font color="Chocolate">黑肩</font>有外心，恐其私交外国，树成<font color="Chocolate">王<font color="Chocolate">子克</font></font>之党，所以不用。<font color="Chocolate">黑肩</font>知<font color="Chocolate">庄王</font>疑己，夜诣<font color="Chocolate">王<font color="Chocolate">子克</font></font>家，商议欲乘嫁王姬之日，聚众作乱，弑<font color="Chocolate">庄王</font>而立<font color="Chocolate">子克</font>。大夫<font color="Chocolate">辛伯</font>闻其谋，以告<font color="Chocolate">庄王</font>，乃杀<font color="Chocolate">黑肩</font>，而逐<font color="Chocolate">子克</font>，<font color="Chocolate">子克</font>奔燕。此事表过不提。且说鲁<font color="Chocolate"><font color="Chocolate">颛孙生</font></font>送王姬至齐，就奉鲁侯之命，迎接夫人<font color="Chocolate">姜氏</font>。<font color="Chocolate">齐<font color="Chocolate">襄公</font></font>十分难舍，碍于公论，只得放回。临行之际，把袂留连，千声珍重：“相见有日！”各各洒泪而别。<font color="Chocolate">姜氏</font>一者贪欢恋爱，不舍<font color="Chocolate">齐侯</font>；二者背理贼伦，羞回故里。行一步，懒一步，车至禚地，见行馆整洁，叹曰：“此地不鲁不齐，正吾家也！”吩咐从人，回复鲁侯：“<a href="http://baike.baidu.com/view/468188.htm">未亡人</a>性贪闲适，不乐还宫。要吾回归，除非死后！”鲁侯知其无颜归国，乃为筑馆于祝邱，迎<font color="Chocolate">姜氏</font>居之。<font color="Chocolate">姜氏</font>遂往来于两地，鲁侯馈问，四时不绝。后来史官议论，以为鲁<font color="Chocolate">庄公</font>之于<font color="Chocolate">文姜</font>，论情则生身之母，论义则杀父之仇，若<font color="Chocolate">文姜</font>归鲁，反是难处之事，只合徘徊两地，乃所以全鲁侯之孝也。<font color="Tomato">髯翁</font>诗曰：</p>

<blockquote><p>弑夫无面返东蒙，禚地徘徊齐鲁中。<br/>
若使腆颜归故国，亲仇两字怎融通。</p></blockquote>

<p>&mdash;<cite>《<a href="http://baike.baidu.com/view/2674.htm#sub5089533">东周列国传</a>》第012回 鲁桓公夫妇如齐　郑子亹君臣为戮</cite></p></blockquote>

<p>这个故事里面公子彭生挺冤，被主公卖了。但是有时候也要看长远，被叫去干这种差事还是需要三思而后行。</p>

<h1>题外话</h1>

<blockquote><p>灵公大怒，索性教左右会放弹的，一齐都放，那弹丸如雨点一般飞去，百姓躲避不迭，也有破头的，伤额的，弹出<strong>眼乌珠</strong>的，打落门牙的，啼哭号呼之声，耳不忍闻，又有唤爹的，叫娘的，抱头鼠窜的，推挤跌倒的，仓忙奔避之状，目不忍见。<br/>
&mdash;<cite>《<a href="http://baike.baidu.com/view/2674.htm#sub5089533">东周列国传</a>》第50回 东门遂援立子倭　赵宣子桃园强谏</cite></p></blockquote>

<p>看到这一段的时候，我又笑了。我猜这个<a href="http://baike.baidu.com/view/28749.htm">冯梦龙</a>很有可能是江南人。果不起然，在百度百科上面看见他是苏州人。呵呵。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[懒人料理其3 营养早午餐]]></title>
    <link href="http://Fatman13.github.io/blog/2013/08/04/lan-ren-liao-li-qi-3-ying-yang-zao-wu-can/"/>
    <updated>2013-08-04T19:05:00+08:00</updated>
    <id>http://Fatman13.github.io/blog/2013/08/04/lan-ren-liao-li-qi-3-ying-yang-zao-wu-can</id>
    <content type="html"><![CDATA[<p>继续写食谱。</p>

<!--more-->


<h1>懒人料理宗旨</h1>

<p>制作简单，能偷懒就偷懒，但是味道还不错。一般都比较能下饭。</p>

<h1>食材</h1>

<p><strong>1</strong> <font color="GoldenRod">面包</font>，<font color="GoldenRod">麦片</font>，<font color="GoldenRod">黄油</font>，<font color="LightSteelBlue">牛奶</font>。</p>

<h1>制作方法</h1>

<p><strong>1</strong>. 把<font color="GoldenRod">麦片</font>倒入碗内，加入<font color="LightSteelBlue">牛奶</font>。</p>

<p><strong>2</strong>. 把<font color="GoldenRod">黄油</font>切片，夹到<font color="GoldenRod">面包</font>内。</p>

<h1>出锅</h1>

<p><img src="http://Fatman13.github.io/images/IMAG0355.resized.jpg" width="555" height="313" title="1" ></p>

<p>很懒。</p>

<h1>附录</h1>

<p><img src="http://Fatman13.github.io/images/IMAG0360.resized.jpg" width="220" height="389" title="1" ></p>

<p><font color="GoldenRod">面包</font>。</p>

<p><img src="http://Fatman13.github.io/images/IMAG0358.resized.jpg" width="220" height="389" title="1" ></p>

<p><font color="GoldenRod">麦片</font>。</p>

<p><img src="http://Fatman13.github.io/images/IMAG0359.resized.jpg" width="220" height="389" title="1" ></p>

<p>香蕉。</p>

<!--肉-->


<p><font color="Crimson"></font></p>

<!--蔬菜-->


<p><font color="ForestGreen"></font></p>

<!--生肉-->


<p><font color="DeepPink"></font></p>

<!--水-->


<p><font color="DodgerBlue"></font></p>

<!--调料-->


<p><font color="SaddleBrown"></font></p>

<!--谷物，黄油-->


<p><font color="GoldenRod"></font></p>

<!--牛奶-->


<p><font color="LightSteelBlue"></font></p>
]]></content>
  </entry>
  
</feed>
